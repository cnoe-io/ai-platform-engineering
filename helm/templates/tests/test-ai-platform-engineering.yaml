apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "ai-platform-engineering.fullname" . }}-test-ai-platform-engineering"
  labels:
    {{- include "ai-platform-engineering.labels" . | nindent 4 }}
    app.kubernetes.io/component: test
  annotations:
    "helm.sh/hook": test
    "helm.sh/hook-weight": "1"
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
spec:
  restartPolicy: Never
  containers:
  - name: test-ai-platform-engineering
    image: bitnami/kubectl:latest
    command: ['sh', '-c']
    args:
    - |
      set -e
      echo "Testing AI Platform Engineering deployment..."

      # Test if AI Platform Engineering agent is running
      if kubectl get deployment {{ include "ai-platform-engineering.fullname" . }} -o jsonpath='{.status.readyReplicas}' | grep -q "1"; then
        echo "✓ AI Platform Engineering agent deployment is ready"
      else
        echo "✗ AI Platform Engineering agent deployment is not ready"
        kubectl get deployment {{ include "ai-platform-engineering.fullname" . }}
        exit 1
      fi

      # Test service connectivity
      if kubectl get service {{ include "ai-platform-engineering.fullname" . }}; then
        echo "✓ AI Platform Engineering service exists"
      else
        echo "✗ AI Platform Engineering service not found"
        exit 1
      fi

      echo "✓ All AI Platform Engineering tests passed"
