atlantis.yaml
new atlantis project
How to generate projects automatically in atlantis.yaml
¶
Problem
¶
Atlantis.yaml needs to be managed every time we start a new project on Atlantis.
Solution
¶
Atlantis has the ability to run pre workflow hooks
link
Hooks are executed before parsing atlantis.yaml, allowing us to generate atlantis.yaml dynamically.
Moving parts:
¶
Template of atlantis.yaml where we define only workflows and common configuration but not projects themselves:
link
PreHook script that generates atlantis.yaml -
link
Script is looking for file main.tf in every folder recursevely, if it finds main.tf then sets project by entire folder
  It will generate needed stanza with default terraform version and default workflow, that defined on script varibles:
COMMON_TF_VERSION="v1.7.2"
COMMON_WORKFLOW="standard"
In case your project needs a specific workflow or tf version, you have to add to the project repo file: meta.json that has the following structure:
{
"workflow": "short",
"tf_version": "1.5.2"
}
Example of autogenerated atlantis.yaml
!!![TIP] Be aware that workflow should be present on atlantis.yaml
Atlantis server configuration -
link
2024-05-20