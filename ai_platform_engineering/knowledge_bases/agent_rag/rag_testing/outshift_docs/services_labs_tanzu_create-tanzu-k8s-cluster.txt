tanzu
How to create a Tanzu K8s cluster
¶
Documentation in progress.
pre-requisite
¶
create a
namespace
in  vSphere UI.
Prepare the cluster config YAML to provision the cluster. See the below sample code to create a kubernetes cluster.
â  ~ cat test-cluster.yaml
apiVersion
:
run.tanzu.vmware.com/v1alpha2
kind
:
TanzuKubernetesCluster
metadata
:
name
:
test-cluster
namespace
:
eti-sre-1
spec
:
topology
:
controlPlane
:
replicas
:
2
vmClass
:
best-effort-xsmall
storageClass
:
tkg-storage-policy
volumes
:
-
name
:
etcd
mountPath
:
/var/lib/etcd
capacity
:
storage
:
4Gi
tkr
:
reference
:
name
:
v1.21.2---vmware.1-tkg.1.ee25d55
nodePools
:
-
name
:
worker-nodepool
replicas
:
2
vmClass
:
best-effort-xsmall
storageClass
:
tkg-storage-policy
volumes
:
-
name
:
containerd
mountPath
:
/var/lib/containerd
capacity
:
storage
:
10Gi
tkr
:
reference
:
name
:
v1.21.2---vmware.1-tkg.1.ee25d55
settings
:
storage
:
defaultClass
:
tkg-storage-policy
network
:
cni
:
name
:
antrea
proxy
:
httpProxy
:
http://proxy.esl.cisco.com:8080
httpsProxy
:
http://proxy.esl.cisco.com:8080
noProxy
:
[
localhost
,
127.0.0.1
,
.cisco.com
,
.gspie.lab
]
Kubect access to the SuperVisor Cluster & switch contexts to the namespace you want to use. see
here
for more information on how to setup kubectl on your cli.
â
~
kubectl
vsphere
login
-u
administrator@vsphere.local
--server
https://10.200.101.234/
--insecure-skip-tls-verify
â
~
kubectl
config
use-context
10
.200.101.234
Switched
to
context
"10.200.101.234"
.
â
~
kubectl
get
ns
NAME
STATUS
AGE
default
Active
105m
eti-sre-1
Active
83m
kube-node-lease
Active
105m
kube-public
Active
105m
....
â
~
kubectl
config
use-context
eti-sre-1
Switched
to
context
"eti-sre-1"
.
~
kubectl
apply
-f
test-cluster.yaml
2023-03-29