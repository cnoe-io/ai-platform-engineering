SJC09 vmware new IP space allocation
¶
Effective Date: Feb 25, 2022
Purpose:
¶
SJC-lab vmware resources were running on a shared subnet(
vlan97
) that many other networking devices and compute resources in the lab are using. The reason we did this change is to have a clean and separate IP space/subnet for our vmware environment to manage our resources more easily and efficiently with the tools we use for our cloud instances, such terraform and ansible. This will also help us to request Direct Internet Access(DIA) from EngIT/infosec more easily.\
Any new vmware VMS or ESXIs that are going to be added to
eti-sj9-vcenter
in the future should be using the new IP space(
10.200.102.0/24
) to keep it consistent and easily manageable.
Add/define the new VLAN:
¶
oobB6#configure terminal
oobB6(config)# vlan 102
oobB6(config-vlan)# name "vmware-subnet"
oobB6#(config-vlan)# exit
Configure Interfaces as Access-Port and Assign to VLAN102
¶
Vlan102 was already exist in the Lab-Gw, therefore no additional configuration was needed.
1. Run a cable between
oobb6
and the
Lab-Gw
and assign the ports to
vlan102
as
access-ports
.
2. configure ESXI/EndPoint connecting interfaces:
!
interface GigabitEthernet1/0/13
 switchport access vlan 102
 switchport mode access
 load-interval 30
!
 interface GigabitEthernet1/0/15
 switchport access vlan 102
 switchport mode access
 load-interval 30
!
interface GigabitEthernet1/0/16
 switchport access vlan 102
 switchport mode access
 load-interval 30
!
Move the IP addresses of all the vmware environment to vlan102
¶
change the vCenter VM IP address:
¶
Changing vCenter vm IP address requires DNS server(s) and the hostname should be resolved. There are different possible ways to do this. However, the simplest is to change it in the vCenter management console.
  - Go to vCneter managemernt console, eti-sj9-vcenter.cisco.com:5480 login with
this
credentials.
  - Navigate to
networking
, then go to
Edit
in the top right-corner of the window.
  - Click next and change the IP address with the correct DNS and hostname entries.
  - Follow the screen instructions to complete the steps.
### change the ESXIs IP addresses:
- updating ESXI server IP address is fairly simple, use the rack-server
CIMC
UI to connect to the ESXI via KVM console.
- for more details about how to change ESXI IP address, see the official
vmware
documenation page.
update the Ubuntu vms IP addresses:
¶
Connect the console of the vm with either the
VMWare Remote Console
or on the web UI.
login the vm and do
ip addr show
to see the virtual NICs available.
remove remove any attached IP address in the vNIC.\
sudo ip addr del 10.200.97.91/24 dev ens160
add a new IP address\
sudo ip addr add 10.200.102.91/24 dev ens160
set the IP interface to up, if needed\
sudo ip link set dev ens160 up
another option
¶
edit the network interface setting
ahismail@eti-appnet-vm1:~$ cat /etc/netplan/00-installer-config.yaml
[sudo] password for ahismail:
# This is the network config written by 'subiquity'
network:
ethernets:
ens160:
addresses:
- 10.200.102.91/24
gateway4: 10.200.102.1
nameservers:
addresses:
- 171.70.168.183
- 10.200.96.87
search:
- cisco.com
version: 2
read more on
SRE-2593
Topology
¶
2023-08-29