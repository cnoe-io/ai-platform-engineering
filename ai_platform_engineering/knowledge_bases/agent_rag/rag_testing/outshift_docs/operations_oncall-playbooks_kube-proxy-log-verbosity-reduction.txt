playbook reduce kube-proxy logging to avoid flooding AppDynamics backend
runbook reduce kube-proxy logging to avoid flooding AppDynamics backend
How to reduce kube-proxy logging to avoid flooding AppDynamics backend
¶
Summary
¶
kube-proxy is a Kubernetes network proxy runs on each node.
kube-proxy is an optional add-on that provides cluster DNS for these cluster IPs.
In dynamic clusters like lightsping-prod-1, a large number of pods are created and destroyed frequently; hence, kube-proxy logs a lot of information about these new network connections. We need to reduce the number of logs generated by kube-proxy so as not to flood AppD.
Caution
kube-proxy is set up as a addon in Terraform and hence, the log level cannot be set via AWS addon configuration
The below configuration may need to be applied after the addon has been updated
Steps to reduce kube-proxy logging via Kubernetes manifest
¶
Login to
target EKS cluster
Examine
kube-proxy
daemonset
kubectl get daemonsets kube-proxy -n kube-system -o yaml
Section to edit
- command:
- kube-proxy
- --v=0
- --config=/var/lib/kube-proxy-config/config
- --hostname-override=$(NODE_NAME)
3. Edit
kube-proxy
daemonset
kubectl edit daemonsets kube-proxy -n kube-system
Set
--v
option to
0
as show below
- command:
- kube-proxy
- --v=0
- --config=/var/lib/kube-proxy-config/config
- --hostname-override=$(NODE_NAME)
Save and exit the text editor
4. Verify daemonset pods have been restarted
kubectl get pods -n kube-system | grep kube-proxy
Look at the last column for pod age.
kube-proxy-25np9                                                  1/1     Running             0                 16h
kube-proxy-26tqv                                                  1/1     Running             0                 16h
kube-proxy-27hgm                                                  1/1     Running             0                 4h50m
kube-proxy-29rwh                                                  1/1     Running             0                 16h
2024-08-14