SRE-2683 Accessing databases from EKS clusters
¶
Table of Contents
¶
Problem statememt
Potential solutions
Database cluster in each EKS VPC.
Database specific VPC
Suggested Solution
Requirements for implementation
Architecture Diagram
Problem statememt
¶
Mutliple EKS clusters need access to AWS shared hosted database resources. Specifically, the new ETI website (
Jira story
) needs a database that is available from either the blue or green deployment.
Potential solutions
¶
Database cluster in each EKS VPC.
¶
Creating a database cluster in the VPC of each of the EKS clusters' VPC. 
  * Pros
    * Simplified routing and security groups.
    * No extra network hops outside the VPC to access the data.
    * No extra work to make sure there aren't overlapping CIDR's in the VPC's.
  * Cons
    * Unknown amount of intervention in the event of changing between blue and green clusters.
    * Database operations are much more complicated.
    * Requires more work when a new EKS cluster is brought online.
       * Some current VPCs do not support db subnets and db subnet group. Which requires tearing down the VPC.
* Creating all the data services (like Aurora, DocumentDB, Kafka) in one VPC will reduce the burden of reprovisioning them. 
       * Creates isolation from computer cluster which are ephemeral
Database specific VPC
¶
Pros
Simpler to write Terraform.
Database operations are much less complicated.
Create all the data services (like Aurora, DocumentDB, Kafka) in one VPC
Reduces the burden of reprovisioning them when compute clusters are re-cycled
Cons
More complicated security and networking.
New EKS cluster VPC's require another step to be added to the
Definition of Done
.
Suggested Solution
¶
Database specific VPC
Requirements for implementation
¶
Guaranteed non-overlapping CIDR between DB VPC and EKS Cluster VPC's
Suggestion: 10.234.0.0/16
Updating EKS Cluster VPC routing tables to DB VPC.
Creating DB VPC routing tables to EKS VPC(s)
Updating EKS Cluster security groups for DB access.
Creating DB Cluster security groups for EKS access.
Architecture Diagram
¶
2023-08-25