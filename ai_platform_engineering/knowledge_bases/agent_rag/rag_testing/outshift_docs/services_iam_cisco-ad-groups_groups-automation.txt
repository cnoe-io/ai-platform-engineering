ad groups automation overview
groups.cisco.com automation
myid-groups.cisco.com automation
Cisco AD Group Automation Overview
¶
sre-cisco-groups-automation
repo provides the necessary tools to automate AD groups via yaml files
In a nut shell, on every commit to
sre-cisco-groups-automation
repo, the tool applies all of the AD groups yaml configuration from the repo to AD groups via REST API
Follow the guides to
add
,
update
,
remove
AD groups via automation.
Caution
â¼ï¸ To avoid configuration drift between git repo and AD config,  AD Groups must to be exclusively managed by sre-cisco-groups-automation. â¼ï¸
Let's first discuss the YAML file/directory structure
Configuration YAML File/Directory Structure
¶
File Structure
¶
Below is an example yaml configuration that represents some of the key attributes of an AD group in a YAML file.
Note
YAML configuration is store in
alphabetical ordering
of the users or child groups
Each section is described below:
group_description
:  AD Group description
member_users
: Member Users (People or Generic Users)
member_groups
: Child Member AD groups
owner_users
: Owner Users (People or Generic Users)
owner_groups
: Child Owner AD groups
example-group.yaml
:
group_description
:
Outshift SREs
member_users
:
-
ahismail
-
dneduva
-
gbouline
-
hkhoury
-
imangass
-
mouledel
-
petersz
member_groups
:
-
eti-sre-ad-groups-admins
owner_users
:
-
damarcil
-
mshoosht
-
sraradhy
-
yovsyann
owner_groups
:
-
eti-sre-ad-groups-admins
Note
Always include
eti-sre-ad-groups-admins
in
member_groups
and
owner_groups
so every SRE team member is automated include in all AD groups
Directory Structure
¶
groups_yaml/
âââ aws
âÂ Â  âââ eticloud
âÂ Â  âââ eticloud-preproduction
âââ teams
âââ _archive
âÂ Â  âââ fednview
âââ panoptica
âââ platform-common
âââ sre
âââ websites
Automation decision tree
¶
Cisco AD Groups Automation currently supports split brain between
legacy AD groups
and
new AD groups
. The following decision tree explains how the automation determines which AD group system the AD group belongs to.
Automation operations
¶
Cisco AD Groups Automation has several operational choices as listed in
Jenkins Job
Apply Operation
¶
Apply all the yaml configuration from repo to AD groups like adding or removing of users.
Also, see
accidental user or child group removal protection
Sync Operation
¶
Sync configuration from AD groups to repo
Run Jenkins with
SYNC
Param
Webex messaging
Also, see
repo update protection
Sync-check Operation
¶
After every
Apply
or
Sync
, a
Sync-Check
is execute to verify if the YAML configuration in the repo matches the AD group information. Otherwise, the SRE team is notified about the discrepency
Caution
SRE team members are expected to check the Jenkins logs and remediate the discrepency between repo and AD groups config.
Failure to remediate the config discrepency can make the automation to stop working
SRE team is notifed in
this webex space
Apply-one Operation
¶
As the name suggests, this option applies only one yaml configuration from the repo to the specific AD groups specified in the Jenkins Param text box.
Sync-one Operation
¶
This option syncs only one yaml configuration from AD group to the repo.
Automation Workflows
¶
Default workflow
¶
Manual sync workflow
¶
Sequence Diagram Source
s
Additional Options
¶
#SKIPSTAGES
: If
#SKIPSTAGES
is in any part of the git commit message, the the Jenkins job will apply Apply, Sync, Sync-chek stages. This option can be negated by checking
DO_NOT_SKIP_STAGES
option in the Jenkins Options
DRYRUN
: As the name suggests, this options only performs dryrun.
SKIP_SYNC_CHECK
: This options
Alphabetical order correction
¶
If a user accidently commits the configuration in alphabetically incorrect order, the automation fixes the alphabetical order unless these are no other
Sync
errors that non-alphabetical.
Repo update protection
¶
When a
Sync
operation is performed, if there is any discrepency between AD groups and repo configuration, the SRE team is notified of the discrepency to remediate it manually.
Caution
SRE team members are expected to check the Jenkins logs and remediate the discrepency between repo and AD groups config.
Failure to remediate the config discrepency can make the automation to stop working
SRE team is notifed in
this webex space
Adding users directly on myid-groups
Accidentaly user or child group removal protection
¶
When a user or a child group is removed from the AD group, the automation sends a Webex notification to a teamspace for a
human
confirmation to remove the user.
20-Sep [15:15:22.878]  [INFO] ********************************************************************************
20-Sep [15:15:22.878]  [INFO] UPDATE-DEL: owner_users:AWS-509581005347-research: ['ahismail']
20-Sep [15:15:22.878]  [INFO] ********************************************************************************
â Groups Automation: Confirm user removal from groups
Webex Notification
:
Troubleshooting
¶
Sync-check failures: User added on UI
¶
If a sync-check shows that an user was added on MyID groups UI then re-run the Jenkins job with
Sync
option and commit the changes back to repo.
Sync-check failures: Users left company
¶
If a sync-check detects user removal in AD groups, one possibility is that the user left company and AD groups removed the user from respective groups.
Check
Cisco directory
if the user still exists with the company. If the user has left the company, re-run the Jenkins job with
Sync
option and commit the changes back to the repo.
Sync-check failures: Automation Parallel Jobs failure
¶
Rarely MyID Groups Automation shows sync differences related to MyID REST API rate limits.
In this scenario, abort the job and retry the sync again
References
¶
https://myid-groups.cisco.com/
https://wwwin-github.cisco.com/eti/sre-cisco-groups-automation
(Legacy)
https://groups.cisco.com
MyID Groups Sharepoint page
2024-05-17