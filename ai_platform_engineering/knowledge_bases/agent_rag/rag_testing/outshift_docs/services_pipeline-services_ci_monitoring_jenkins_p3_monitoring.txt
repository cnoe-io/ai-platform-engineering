Jenkins & P3 Monitoring
¶
Introduction
¶
Our monitoring system is currently based on
OpenTelemetry
. We're deploying some components in our build infra (Jenkins nodes in P3 and AWS) and also for developer VMs in P3. Those components are consul, cadvisor are node exporters deployed by and
Ansible playbooks
.
Service discovery
¶
Prometheus offers a variety of service discovery options for discovering scrape targets, including Kubernetes, Consul, Azure VMs, AWS EC2, etc.
Basic exporters
¶
Node exporter
¶
Installed on the Linux operation machine. Exports statistics about network, I/O, CPU, memory, filesystems for hardware and OS metrics by kernels.
cAdvisor
¶
Exposes CPU, memory, network and I/O usage from containers.
Blackbox exporter
¶
The blackbox exporter allows blackbox probing of endpoints over HTTP, HTTPS, DNS, TCP and ICMP.
Requirements
¶
CentOS, Ubuntu
Ansible Playbook
¶
Here is the link to the playbook used for deploying monitoring components:
Jenkins P3 nodes
Jenkins cloud nodes
developer P3 nodes
These Ansible playbooks installs node exporter, cadvisor, consul client on all hosts part of the inventory.
Consul cluster used for service discovery on port 8300 to 8303
Prometheus NodeExporter service on port 9100
Cadvisor service on port 8080
Hosts inventory file
¶
[
nodes
]
eti-jenkins-canary-test-002 consul_iface=eth0 consul_node_role=client consul_datacenter=canary jenkins_node_labels='canary' jenkins_node_executors=4 jenkins_workspace=/mnt docker_workspace=/mnt
see
Jenkins P3 nodes inventory
for example.
Dependencies
¶
Ansible versions >= 2.9.27
Python 3
2024-07-23