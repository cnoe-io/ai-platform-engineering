atlantis commands
atlantis workflow
Using Atlantis
¶
How to use Atlantis in the Outshift Platform.
Prequisites
¶
Setup a repository for Atlantis
Atlantis.yaml setup
Workflow
¶
Atlantis follows a
GitOps workflow
.
The general pattern is:
start a branch
git
clone
git@wwwin-github.cisco.com:eti/sre-tf-infra.git
git
checkout
-b
add-resource-foo
add
Terraform
following the
Atlantis standards
update the
atlantis.yaml
create a Pull Request (PR)
git
commit
-am
"chore: add resource <foo>"
git
push
origin
add-resource-foo
Atlantis will automatically run a
terraform plan
for the project under code review
Get approval from one of the CODEOWNERS
run
Atlantis commands
Atlantis commands
¶
atlantis plan
¶
Automatically run when a PR is created.
If there are multiple projects in the PR:
Each project will have its own
plan
and comment.
If the projects have dependent resources, the dependent projects will respond with a 'plan' error.
To work with you have a specific project you'd like to `plan`` you can comment in the PR:
atlantis plan -p <project_name>
plans a specific Atlantis project.
atlantis plan -d <directory_path>
plans a specific folder in the repository.
atlantis destroy
¶
atlantis plan -- -destroy
This is specific to removing resources and must be run as a comment after the automatic plan that happens when a PR is created.
It is possible to use the
-p <project_name>
or
-d <directory_path>
before the
--
above if you wish to destroy a specific project or directory.
Once the
plan
is complete, Atlantis will write another comment in the PR with the expected changes. Review this plan
very
carefully before running
apply
commands.
atlantis apply
¶
Apply
s (runs) all the projects in the PR.
Once an
apply
is started, it cannot be stopped.
The PR will be merged and the branch deleted if all the projects in the PR are successfully run by an
atlantis apply
.
Specify the
--auto-merge-disabled
flag in your apply command to disable auto-merge for that apply.
If a project or directory is specified in a
plan
, that project or directory must also be specified in the
apply
:
atlantis apply -p <project_name>
Atlantis will fail with an
unknown workspace
error if you attempt to run
atlantis apply
after having planned a specific project or directory.
Atlantis will not close the PR and delete the branch if a project or directory is specified.
Targetted apply
¶
Atlantis also supports the
-target
Terraform flag, but you have to
plan
with that flag, then apply that plan like so:
Warning
Targetted applies should be avoided as much as possible as it creates drift. This is only useful when trying to apply an immediate (and targetted) fix.
atlantis
plan
--
-target
=
'module.eks_all_in_one.aws_launch_template.this[0]'
# a targetted plan will be generated in the PR comment
# apply that plan without a flag
atlantis
apply
[
-p
<project>
]
.
# optional subcommand
Atlantis Project Standards
¶
Atlantis Project Path
¶
Atlantis Project Name
¶
2025-02-09