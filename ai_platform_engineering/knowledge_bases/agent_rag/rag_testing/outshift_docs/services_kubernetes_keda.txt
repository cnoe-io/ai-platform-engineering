kafka scaling
keda
scaling
Keda
¶
Keda replaces or augments HPA and allows scaling on triggers more than CPU and Memory.
The keda Chart is imported in the sre-helm-charts repo.
The chart can be deployed with no impact to a cluster. It installs CRDs, a manager, and a metrics server.
https://github.com/kedacore/charts/tree/main/keda/templates
Use
¶
Any cluster with keda installed can create the objects required to allow keda to scale a deployment.
The ScaledObject defines the target to scale -- usually a deployment -- and the triggers.  Keda recommends it replace HPA so triggers should include CPU and memory.
Other types of triggers, e.g. kafka to scale based on consumer group lag are available. See
https://keda.sh/docs/2.15/scalers/
for more.
e.g.
apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
name: myapp-kafka-scaledobject
namespace: myns
spec:
maxReplicaCount: 10
minReplicaCount: 1
scaleTargetRef:
name: myapp
pollingInterval: 30
triggers:
- type: kafka
metadata:
bootstrapServers: example1.kafka.us-east-2.amazonaws.com:9096,example2.kafka.us-east-2.amazonaws.com:9096
consumerGroup: myappcg
topic: mytopic
# Optional
lagThreshold: "1000"
offsetResetPolicy: latest
authenticationRef:
name: myapp-credential
- type: cpu
metricType: Utilization # Allowed types are 'Utilization' or 'AverageValue'
metadata:
value: "60"
- type: memory
metricType: Utilization # Allowed types are 'Utilization' or 'AverageValue'
metadata:
value: "60"
The scalar might reference an authentication config. This is a TriggerAuthentication object which brings together values of one or more secrets.
e.g.
apiVersion: keda.sh/v1alpha1
kind: TriggerAuthentication
metadata:
name: myapp-credential # from authenticationRef above
namespace: myns
spec:
secretTargetRef:
- parameter: sasl
name: myapp-secrets
key: sasl
- parameter: username
name: myapp-secrets
key: KAFKA_USERNAME
- parameter: password
name: myapp-secrets
key: KAFKA_PASSWORD
- parameter: tls
name: myapp-secrets
key: tls
The secrets include the SASL auth mechanism and if TLS is used to connect to kafka. These aren't secret data, but must be in a secret to be read.
An application's helm chart should include the above CRD to scale with keda.
2024-09-06