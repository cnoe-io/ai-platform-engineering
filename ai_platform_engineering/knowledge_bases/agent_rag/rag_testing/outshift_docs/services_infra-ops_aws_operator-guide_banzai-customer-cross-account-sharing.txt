Banzai Customer Cross-account sharing guide
¶
This guide explains how to setup cross-account sharing for banzai S3/ECR artifacts to access binaries, helm charts and containers for banzai products.
As of May 2022 this process is only needed for SDM artifacts.
Note
: SMM artifacts can be accessed using
ETI PLG website
Pre-requisite
¶
Gather customer's AWS Account ID for setting up cross-account access
Steps to enable access
¶
Clone banzai-infra repo
git
clone
git@wwwin-github.cisco.com:eti/banzai-infra.git
Create a branch with task JIRA ID
git
checkout
-b
SRE-XXXX
Update terraform code in customer/artifacts
Follow this example
PR
Review the terraform plan posted by atlantis and make sure it reflects the intended change
Note:
Due to an ongoing
issue
in terraform and aws provider, terraform shows more diff than the added changes
Carefully validate the accounts removed and added match up to existing S3 bucket policy
Apply terraform changes in the PR after approvals by adding the following
atlantis
command as a comment in that PR:
atlantis
apply
-p
banzai-customer-artifacts
Note:
Auto-merge of the PR has been disable on this repo to mitigate the issue in next step
Due to the ongoing re-ordering issue as described earlier, it is best to run the
atlantis plan -p banzai-customer-artifacts
one more time to check for any additional diffs. If no additional diffs are detected, the PR is safe to merge.
Verification
¶
Notify the customer to verify access to the artifacts
2022-05-26