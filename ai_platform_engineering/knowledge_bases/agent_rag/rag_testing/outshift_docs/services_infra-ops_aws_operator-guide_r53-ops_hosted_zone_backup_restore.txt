Route53 Hosted Zone DR
¶
Route53 Hosted Zone DNS Records managed by SRE are backed up daily in S3. The records are backed up using a scheduled AWS Lambda function.
This document will describe the project that performs the backups, how to validate backups, and how to attach alerting in the case of failure.
The records are backed up in JSON, and CSV format to allow for multiple methods of restoration. Guidance for the restoration using the AWS command line will be described, but other methods can be used.
R53 Backup CDK Project
¶
The lambda function, S3 bucket, scheduling, monitoring resources are created and modified using an AWS Cloud Development Kit (CDK) project.
The project is kept in the
SRE Utilities
git repository.
The CDK project is written in Python, and uses AWS Cloud Formation. The deployed project is located
here
Note
The
AdministratorAccess
policy has been removed from the CDKToolkit CloudFormation Stack in the
eticloud
AWS Account. This permission will need to be restored, prior to execution of this CDK project
    -
Jira Link
The project can be modified and updated by administrators of the
eticloud
AWS account which is where the Route53 Hosted Zone records are managed.
Lambda
¶
Import Function
EventBridge
¶
Cron Rule
Watchful
¶
Job History
Alarms
Alert Topic
DNS Record Backups
¶
S3 Bucket
Project Development and Deployment
¶
Developing with AWS CDK
Install and configure CDK:
¶
Working with the AWS CDK
Set Target Region:
¶
export AWS_DEFAULT_REGION=us-east-2
Bootstrapping
(New Implementation Only)
¶
Common Activities
¶
These commands are executed within the cdk project directory
r53_backups_cdk
Like the AWS CLI, these commands support the
--profile
argument for context.
-
cdk diff
- Used to verify changes to the application.
cdk deploy
- Used to apply changes to the application.
Source Control
¶
Following a successful deployment, a PR should be made to the project to avoid drift.
Record Restoration
¶
In the event of a disaster, or inadvertent change, a record set can be restored using the
change-resource-record-sets
AWS CLI command.
* Download the
json
file of the hosted zone from within the S3 bucket with timestamp folder you wish to restore.
* Follow the
change-resource-record-sets
process, or apply this command line within a script to restore records in bulk.
2024-10-14