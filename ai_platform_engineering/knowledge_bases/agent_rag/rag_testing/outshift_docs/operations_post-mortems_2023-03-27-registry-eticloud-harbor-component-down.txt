post mortem
registry.eticloud.io component down
2023-03-28;
SRE-5200
;
registry.eticloud.io harbor components down
¶
Summary
¶
Harbor components jobservice and portal are down and SRE team was alerted to be down
When
¶
Paged on March 25
th
2023 at 7:16 AM
Timeline
¶
2023-03-25
0716 CDT - SRE Engineer paged.
Verified customer impact was none
Registry was externally accesible
registry.eticloud.io portal was accessible
SRE Engineer the page until Monday to triage
2023-03-27
0716 CDT - Page unsilenced and re-paged. SRE engineer ack'ed the page
1123 CDT - Started analyzing the issue
1210 CDT - The
playbook
did not match the
health dashboard
.
Follow-on story to fix that
1220 CDT - Platform Health Dashboard confirmed the harbor job/portal services were down.
Although the overal health status was a bit mis-leading
1232 CDT - After determining that job and portal service need to be restarted, SRE team notified
Platform Status space
that those deployments will be restarted.
1238 CDT - Job and portal have been recovered
Impact
¶
There is
no customer impact
regarding downloading the images or dev impact accessing the portal
The job sync service was impacted. This was restored first thing on Monday during business hours
Analysis
¶
Harbor certificates are renewed every 90 days using cert manager. When the cert renewal happens, harbor internal components cannot communicate with Harbor core until the pods for each of the services like chartmuseum, registry, jobservice, portal service are restarted
SRE team added a
restart cron job
that only restarted chartmuseum and registry services. We need to add jobservice and portal service to this list
There is an pending issue with Harbor operator that would prevent the above issue from happening.
https://github.com/goharbor/harbor-operator/issues/712
Takeaways
¶
Add jobservice, portal service to
monthly restart cronjob
Update registry grafana health dashboard to match the playbook
2023-03-28