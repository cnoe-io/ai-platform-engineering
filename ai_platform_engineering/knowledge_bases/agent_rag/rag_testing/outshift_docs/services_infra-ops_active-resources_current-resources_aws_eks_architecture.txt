EKS Shared cluster architecture
¶
VPC Setup
¶
Notes:
VPC Security:
There are no outbound ACL's or Security Groups from any subnets.
There are no intra-VPC Security Groups.
VPC Endpoints:
VPC Endpoints are not created automatically, but with the instantiation of other services like EKS.
Network Load balancers created by EKS clusters
Bastion:
Bastion instances are created from Cloud 9 hardened AMI's.
Inboound SG's to the bastion are limited to Cisco CIDR's on TCP Port 22.
The bastion can only communicate to the rest of the VPC on TCP:22
SSH Keypairs are installed per user and stored in a private s3 bucket for loading onto the bastion. NOT connected with Duo.
VPC Peering:
VPC peering is only created between production EKS VPC's and production database VPC's.
EKS Cluster
¶
Base Apps
¶
Base apps details
EKS Node Groups
¶
Public Node Groups
¶
Public Node groups are nodes in public subnets.
They are setup with a node taint.
Only pods which can tolerate the following taint will be scheduled on these nodes
â¯ k describe nodes ip-10-0-6-149.eu-west-1.compute.internal
Taints:             node-type=public:NoSchedule
Example:
apiVersion
:
v1
kind
:
Pod
metadata
:
name
:
nginx
labels
:
env
:
test
spec
:
containers
:
-
name
:
nginx
image
:
nginx
imagePullPolicy
:
IfNotPresent
tolerations
:
-
key
:
"node-type"
operator
:
"Equal"
value
:
"public"
effect
:
"NoSchedule"
Private Node Groups
¶
By default all workloads will be scheduled in nodes in private vpc subnets
Code References
¶
EKS Terraform Module
2023-09-03