ABOUT THE CVE-2021-21985 VULNERABILITY
¶
The vSphere Client (HTML5) contains a remote code execution vulnerability due to lack of input validation in the Virtual SAN Health Check plug-in which is enabled by default in vCenter Server. A malicious actor with network access to port 443 may exploit this issue to execute commands with unrestricted privileges on the underlying operating system that hosts vCenter Server. (VMware Documentation)
TEMPORARY SOLUTION: DISABLE THE VIRTUAL SAN HEALTH CHECK PLUG-IN
¶
Connect to the vCenter Server using SSH and root credentials:
ssh
-o
PubkeyAuthentication
=
no
root@10.60.17.11
Backup the /etc/vmware/vsphere-ui/compatibility-matrix.xml file:
cp
-v
/etc/vmware/vsphere-ui/compatibility-matrix.xml
/etc/vmware/vsphere-ui/compatibility-matrix.xml.backup
Open the file compatibility-matrix.xml and add the line below in the file between "→ <!- entries
<PluginPackage
id
=
"com.vmware.vsphere.client.h5vsan"
status
=
"incompatible"
/>
The file should look like this:
Save the file
Stop/Start vsphere-ui service:
service-control
--stop
vsphere-ui
service-control
--start
vsphere-ui
Connect to the vCenter vsphere client UI
http://pirl-vcenter.cisco.com
Go to Administration>Client Plug-Ins to note that the Plug-in is now incompatible and disabled:
DURABLE SOLUTION/ PATCH THE VCENTER SERVER APPLIANCE TO THE FIXED VERSION (6.7 U3n) USING THE APPLIANCE MANAGEMENT INTERFACE
¶
Connect to the vCenter Server management interface:
http://pirl-vcenter.cisco.com:5480
(see root/password in keeper)
Click on "Summary" to check the current version & build number
Make a backup of the vCenter Server
Click on Update then select the last version of the available updates
Click on "STAGE AND INSTALL"
Once the process is complete click on "Summary" to check the new version and build number
To perform ISO-based patching:
Download an ISO image (VMware-VCSA-all-6.7.0-18010531.iso) from
Toolbox
Connect to the vcenter vsphere Client UI:
http://pirl-vcenter.cisco.com
-
administrator@vsphere.local
/password
Attach the ISO image to the CD/DVD drive of the appliance
Go to the VCSA Management Interface
http://pirl-vcenter.cisco.com:5480
Click on "Update", then "Check Updates", then "Check CD ROM"
Click on "STAGE AND INSTALL" to install the patches.
Once the process is completed click on "Summary" to check the new version and build number:
2022-04-20