vault cli setup
CLI access
¶
Make sure the
Vault CLI
is installed:
MacOS:
brew
install
vault
Nix:
nix-env
-iA
nixpkgs.vault
Vault cli login with oidc
¶
export
VAULT_ADDR
=
"https://keeper.cisco.com"
export
VAULT_NAMESPACE
=
"<vault_namespace>"
export
VAULT_ROLE
=
"<vault_role>"
export
VAULT_TOKEN
=
$(
vault
login
-method
=
oidc
-format
=
json
|
jq
-r
.auth.client_token
)
Additional info about roles and namespaces
here
Sample Output:
Complete
the
login
via
your
OIDC
provider.
Launching
browser
to:
https://sso-dbbfec7f.sso.duosecurity.com/oidc/<REDACTED>
Waiting
for
OIDC
authentication
to
complete...
WARNING!
The
VAULT_TOKEN
environment
variable
is
set!
The
value
of
this
variable
will
take
precedence
;
if
this
is
unwanted
please
unset
VAULT_TOKEN
or
update
its
value
accordingly.
Vault Web UI Login and copy vault token
¶
Login to the web UI
, click on the dropdown menu in the right upper corner and click
Copy token
.
Set the following environment variables:
export
VAULT_ADDR
=
https://keeper.cisco.com
export
VAULT_NAMESPACE
=
eticloud/apps/sre
export
VAULT_TOKEN
=
<COPY
TOKEN
FROM
STEP
ABOVE>
Vault login command
¶
Vault token can be set globally using the following:
Caution
vault login
command will store vault token to the filesystem at
~/.vault-token
.
vault
login
-no-print
Vault sample commands
¶
Use the
vault
CLI to get and put secrets from/into Keeper:
# List secrets in kv or folder
vault
kv
list
secret/
# Get all values in a secret
vault
kv
get
secret/access-test
# Read a specific value from key
vault
kv
get
-field
=
foo
secret/access-test
# Add a key-value pair without overwriting existing values
vault
kv
patch
secret/access-test
foo2
=
bar2
# Add a new version of a secret overwriting existing values
vault
kv
put
secret/access-test
foo
=
bar
# Rollback to a previous version (creates new version with old values)
vault
kv
rollback
-version
=
1
secret/access-test
Troubleshooting
¶
Error authenticating: Unable to authorize role "" with redirect_uri "http://localhost:8250/oidc/callback". Check Vault logs for more information.
When using the CLI, make sure the
VAULT_ADDR
,
VAULT_ROLE
, and
VAULT_NAMESPACE
are properly set.
2023-10-10