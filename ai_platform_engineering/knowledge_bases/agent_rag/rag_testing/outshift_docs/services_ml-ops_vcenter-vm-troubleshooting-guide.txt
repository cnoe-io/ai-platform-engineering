vCenter Server and VM Troubleshooting Guide
¶
This document aims to provide a simple guide for troubleshooting minor errors that may frequently occur in the VMware environment.
For more complex issues, please open a case with GLS by following the steps described below:
Navigate to
https://toolbox.cisco.com/cases/new
Type
RTP6P
in the
Service Location
field
Choose
GLS Lab Services
in the
Service Organization
field
Select
Virtualization
>>
CLVS Dedicated Blade - Report A Problem
as
Case Type
Click on
Next
In the following page, fill out the form with the required informations (Choose
RALEIGH-DURHAM NC
as
CLVS POD Location
)
Click on
Create Case
After creating the case, you'll receive a confirmation email with the case link
Prerequisite
¶
As a Platform Engineering team member, you need to request that your admin access to the
rtp6-cls-hc101-vc
vCenter server be setup so you can manage the VMWare resources controlled by the the vCenter.
- Please reach out to
msardara
or
imangass
to request your access to the vCenter vSphere Web Client
- Or open a
Toolbox case
as shown previously
- Some tasks described in this documentation require your SSH access to be configured on the vCenter server. You will need to submit a request to GLS, as we do not have access to the root password
How to grant admin access on the vCenter server
¶
As a vCenter Server admin, here are the steps to follow to grant admin access to another team member
- Log in to the
vCenter vSphere Web Client
with your CEC credentials
- Select
rtp6-cls-hc101-vc.cisco.com
in the Inventory tab
- click on the
Permissions
- Then click on
ADD
- Configure the permissions as show below:
![](./resources/vc-tbshooting-doc-permissions.png)
Please check the
Propagate to children
option so the user can exercise his admin privileges on the current resources and all the others that will be created in the future
vCenter server issues
¶
Before proceeding any further with the vCenter troubleshooting, it's recommanded to create a snapshot of the vCenter VM
- Select
Inventory
- Right-click on the vCenter server VM
- Select
Snapshots
then click on
Take Snapshot
SSH Connection Refused
¶
Open a Toolbox case to request your SSH access to the vCenter be set up as we do not have the root credentials
In the meanwhile, as a vCenter server admin, you should be able to connect to the
vCenter Appliance Management Interface(VAMI)
and check the SSH login status
Click on
Edit
then
Activate SSH Login
Test your SSH access
ssh imangass@rtp6-cls-hc101-vc
Connection TimeOut Error
¶
Cause
: The first thing to check is if the vCenter server is powered on. Because this error suggests that the browser is unable to establish a connection with the server. And in most cases this happens when the vCenter Server is powered down (following electrical outage in the lab for example) and therefore it cannot respond to client requests
Power on the vcenter server VM from the vSphere Web Client
- First, you need to determine which ESXi server is hosting the vCenter VM. Currently it is the
rtp6-cls-hc101
ESXi host
- Navigate to the
https://rtp6-cls-hc101.cisco.com
ESXi server vSphere UI
- Right-click on the vcenter server
rtp6-cls-hc101-vc
, select
Power
and click on
Power On
If the ESXi host is not reachable
go to the ESXi host troubleshooting section
It is also possible to boot up the vCenter server VM using CLI
- Request your SSH access to the ESXi host
- SSH into the server hosting the vCenter VM:
ssh imangass@rtp6-cls-hc101
- Run this command to list all VMs and ther IDs:
vim-cmd vmsvc/getallvms | awk '{print $1, $2}'
- Run this command to power on the vCenter server using its ID:
vim-cmd vmsvc/power.on 3
No healthy upstream
¶
This error, which prevents access to the vCenter vSphere UI, may occur because not all critical services have started, especially after the vCenter server has rebooted.
After waiting a few minutes, if the vSphere UI is still not accessible, check the status of the vSphere UI service:
Throught the VAMI:
Log in to
the vsphere VAMI
with your CEC credentials
Click on
Services
and check the
VMware vSphere Client
status
Start the
VMware vSphere Client
service from the top menu
Using SSH
Request SSH access from GLS if it has not yet been set up for you
SSH into the vCenter Server Appliance
ssh imangass@rtp6-cls-hc101-vc
Check the
VMware vSphere Client
status:
service-control --status vsphere-ui
Start the service:
service-control --status vsphere-ui
Another possible cause could be that the vSphere UI fails to load due to insufficient resources on the vCenter server.
To verify the available resources on the vCenter server:
SSH into the vCenter server.
Check disk space availability:
df -h
Check memory and CPU usage:
free -h
,
top
If resources are insufficient:
Clear unused data to free up storage.
Alternatively, request the GLS lab team to allocate additional resources to the vCenter server or its ESXi host
VM troubleshooting
¶
Orphaned VM recovery
¶
In certain cases, a VM may become orphaned if the ESXi host can no longer recognize it for some reason, causing the VM to be unregistered from the host.
To resolve this, you need to migrate the orphaned VM to another ESXi host within the datacenter.
!!! ** Note**
The target ESXi host must have access to the same datastore where the VM's files are stored so that the migration can work
Select the VM in the Inventory
Right-click and select migrate
A list of hosts sharing the same datastore as the orignal one will appears
Select a the target ESXi server then click OK
If the migration feature is not available proceed as follows to remove the VM from the inventory then Reregister it on another host
- Locate the datastore where the VM's file are located
    - Click on the VM in the Inventory and select
Datastores
in the central pane
    - The datastore where the VM's file are located will be displayed, click on it
    - Select the VM folder
    - Check the VM's
.vmx
file or
.vmtx
file (the VM template configuration file)
- Return to the VM in the inventory
- Right-click on the VM and select
Remove From Inventory
- Register the VM on another ESXi host
    - Go back to the VM's
.vmx
or
.vmtx
file as shown previously
    - select the file then click on
Register
- Follow the steps and select respectively the target folder and ESXi host in step1 and step2
    - Click on finish
VM disconnected
¶
Sometimes, a "Disconnected" VM is due to issues with the ESXi management agent.
Solution:
- Locate the ESXi server that hosts the VM
- SSH in to the ESXi host
- Restart the ESXi host management agents
```
/etc/init.d/hostd restart

/etc/init.d/vpxa restart
```
If the ESXi itself is not Disconnected
Login to the vSphere Client.
Right click on the ESXi server hosting the VM in the Inventory.
Click Disconnect.
Once the task status changes to complete, right click on the ESXi from the Inventory.
Click on
Connect
.
Wait until the task status changes to complete.
A VM failing to start.
¶
Cause 1
: Unsufficient VM ressources
Solution
:
- Check the VM logs in vSphere UI for any errors.
- Ensure sufficient resources (CPU, RAM) are available.
- Look for GPU-related error messages if applicable.
- Try restarting the VM
Note
A host expired VMware licence can prevent the VMs hosted on it from starting. If you see a message related to expired certificate or expired vCenter licence, you need to open a Toolbox case to the GLS service in order to request a licence renewal
ESXi Host access issues
¶
Cannot Access the vSphere Web Client
¶
Cause:
The server is possibly shut dwn or the vSphere Web Client service on the ESXi host may not be running or responding.
Solution:
- Ping the ESXi host IP or FQDN
- Log in to the vCenter server vSphere UI to boot up the ESXi server
    - Select the host in the inventory
    - Right-click on the server, select
Power
then click
Power On
- You can also boot up the server from the CIMC
    - Get the server CIMC access infos from
Vault
- Access the CIMC using
the CIMC IP address
or
the URL
- In the CIMC Interface, select
Host Power
then click on
Power On
- Wait a few minutes until all critical services get started then try to log in to the vSphere Client
- Try to ping the host a second time
- If the the ping is not successful, check the server link in the from the DCUI (if you have the root password or admin privilege on the server
    - Access the server CIMC
    - Click on
Launch vKVM
- On the DCUI interface, click
F2
of your keyboard
    - Enter the root cretendials
    - Navigate to
Configure Management Network
>>
Network Adapters
- Make sure that at least one of the
vmnic
adapters with status
Connected
is checked
- Click on
Esc
to exit, then on
Enter
to apply your changes
    !!! Note
        If none of the vmnic has a status
Connected
this means that the physical link between the server and the switch is failing. Then you need to open a toolbox case to GLS to get the cables checked
    - Check the Host IP configuration
        - from the DCUI, navigate to
Configure Management Network
>>
IPv4 Configuration
- Verify that the IP configuration is correct:
- If ping succeeded and after waiting a few minutes the vSphere web client is still unreachable:
- Access the ESXi host via SSH.
- Restart the management agents on the ESXi host by running:
    ```
    /etc/init.d/hostd restart
    /etc/init.d/vpxa restart
    ```
- Check the status of the vSphere Web Client service:
    ```
    /etc/init.d/rhttpproxy status
    ```
    If it's not running, start the service:
    ```
    /etc/init.d/rhttpproxy start
    ```
SSH connection refused
¶
In such cases, the first step is to check whether the SSH service is enabled.
By default, the SSH service is disabled for security reasons. The service is also disabled after the server is restarted.
Enabling the SSH service can be done in the following ways:
Via vCenter Server vSphere UI
Log in to the
vCenter Server vSphere UI
.
Navigate to the
ESXi host
where you want to enable SSH.
Select the
Host
then the
Configure tab
Under
System
, click
Services
.
Select the
SSH
service and start it
Via the ESXi Host vSphere UI
Open the ESXi Host vSphere UI (Find the URL and root credentials in
Vault
)
Log in with root credentials.
In the left menu, go to
Host
>
Manage
.
Under
Services
, select
TSM-SSH
and start the service
!!!
Note:
As a security best practice, please disable SSH when it's no longer needed
Server Taking Too Long to Respond
¶
Cause:
This error can occur if the vSphere Web Client service is not running or if the ESXi host is under heavy load.
Solution:
- Check available resources (CPU, memory, disk space) on the ESXi host:
esxtop
df -h
- Free up resources or request a server resource upgrade from GLS team
2025-02-09