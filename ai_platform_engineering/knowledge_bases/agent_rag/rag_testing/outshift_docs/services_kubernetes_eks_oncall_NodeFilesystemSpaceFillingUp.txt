NodeFilesystemSpaceFillingUp
¶
Tags
: "Node space is filling up"
Symptoms
¶
One of the K8s node space is filling up
Example:
â ï¸ Incident
#6057
eks-production-1: NodeFilesystemSpaceFillingUp:
was triggered by the Prometheus service and assigned to Dev Null.
Summary
¶
K8s automatically garbage collects
K8s runs garbage collection when the node is more than 85% full (default setting)
There are two alerts related to node space is filling up
Filesystem is predicted to run out of space within the next 24 hours.
Prometheus Expression
https://mcom.eks-prod-1.prod.eticloud.io/prometheus/graph?g0.expr=(node_filesystem_avail_bytes%7Bfstype!%3D%22%22%2Cjob%3D%22node-exporter%22%7D%20%2F%20node_filesystem_size_bytes%7Bfstype!%3D%22%22%2Cjob%3D%22node-exporter%22%7D%20*%20100%20%3C%2040%20and%20predict_linear(node_filesystem_avail_bytes%7Bfstype!%3D%22%22%2Cjob%3D%22node-exporter%22%7D%5B6h%5D%2C%2024%20*%2060%20*%2060)%20%3C%200%20and%20node_filesystem_readonly%7Bfstype!%3D%22%22%2Cjob%3D%22node-exporter%22%7D%20%3D%3D%200)&g0.tab=1&g0.stacked=0&g0.show_exemplars=0.g0.range_input=1h.
Filesystem is predicted to run out of space within the next 4 hours.
Prometheus Expression
(node_filesystem_avail_bytes{fstype!="",job="node-exporter"} / node_filesystem_size_bytes{fstype!="",job="node-exporter"} * 100 < 15 and predict_linear(node_filesystem_avail_bytes{fstype!="",job="node-exporter"}[6h], 4 * 60 * 60) < 0 and node_filesystem_readonly{fstype!="",job="node-exporter"} == 0)
Resolution
¶
Look at the node dasboards
SSH into the node with kubectl-ssh
Check for node disk space usage
df -h
      du -hS
Delete logs accumulated by loki in /var/log/containers
Testing
¶
fallocate is a utility that can create large files to validate disk consumption
commandline
  fallocate 15G
Wait for K8s garbage collector to kick-in and clean-up disk space
References:
-
https://kubernetes.io/docs/concepts/architecture/garbage-collection/#containers-images
2022-05-03