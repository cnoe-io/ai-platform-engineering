Install ArgoCD Operator
¶
â ï¸ Note: Skip this step if ArgoCD Operator is already installed on the target cluster.
You can check if it's already installed by looking into the
argocd-operator-system
namespace:
kubectl
-n
argocd-operator-system
get
all
Install using SRE Prod ArgoCD
¶
Prerequisites:
Target cluster
is added
to
SRE Prod ArgoCD
This is the preferred method of installing ArgoCD Operator.
Checkout the
sre-cluster-configs
repository
Go to
sre/argocd-operator/
Copy the configuration from an existing installation (and tweak it to your needs)
Commit and push the changes
Wait for ArgoCD to synchronize to the new cluster (or do it manually)
# Replace NEW_CLUSTER with your cluster name below
export
CLUSTER_NAME
=
NEW_CLUSTER
git
clone
git@wwwin-github.cisco.com:eti/sre-cluster-configs.git
cd
sre-cluster-configs/sre/argocd-operator
cp
-r
gbear-gitops
$CLUSTER_NAME
cd
$CLUSTER_NAME
unlink
config.json
ln
-s
../../_cluster-config/
$CLUSTER_NAME
/config.json
# Make some changes to the configuration as necessary
git
add
.
git
commit
-m
"install argocd-operator on
$CLUSTER_NAME
"
git
push
Manual installation
¶
Prerequisites:
Kube context is set to
access the target cluster
Use this method when SRE Prod ArgoCD cannot access the target environment.
Create a new
kustomization.yaml
with the following content:
apiVersion
:
kustomize.config.k8s.io/v1beta1
kind
:
Kustomization
commonLabels
:
app.kubernetes.io/name
:
argocd-operator
app.kubernetes.io/instance
:
argocd-operator
labels
:
-
pairs
:
app.kubernetes.io/version
:
v0.2.1
resources
:
-
github.com/argoproj-labs/argocd-operator/config/default?ref=v0.2.1
images
:
-
name
:
quay.io/argoprojlabs/argocd-operator
newTag
:
v0.2.1
Actualize the version to your preference
Apply the rendered manifests to the cluster:
kustomize build | kubectl apply -f -
TODO:
Save the
kustomization.yaml
file somewhere (argocd-instances?)
2023-09-21