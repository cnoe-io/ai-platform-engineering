LDAP server
Setup OpenLDAP server on Ubuntu 20.04
¶
This document explains Step-by-Step  process on how to install openLDAP-server on ubuntu 20.04.
Step 1: Set the hostname and resolve the IP address locally
¶
Set the Ubuntu server hostname.
sudo
hostnamectl
set-hostname
gspie-ns1.cisco.com
Add the IP and FQDN to file /etc/hosts
```sh
  $ sudo nano /etc/hosts
10.200.96.87 gspie-ns1.cisco.com
    ```
Step 2: Install the software packages
¶
Install slapd ldap-utils
sudo
apt-get
install
slapd
ldap-utils
-y
During the installation, youâll be asked to create an administrator password, so make sure to type and verify when prompted.
After you completed the installation, check that everything is installed as expected by issuing
sudo slapcat
command on the cli.
If you see any typo or missing configuration in the output use
sudo dpkg-reconfigure slapd
command and re-correct it.
Step 3: Add Groups and Users
¶
Configure the BaseDN
create a filename basedn.ldif with the following content.
```sh
  $ nano basedn.ldif
dn: ou=people,dc=gspie,dc=lab
  objectClass: organizationalUnit
  ou: people
  dn: ou=groups,dc=gspie,dc=lab
  objectClass: organizationalUnit
  ou: groups
  ```
Add the file to the ldap server by issuing the below command.
ldapadd
-x
-D
cn
=
admin,dc
=
gspie,dc
=
lab
-W
-f
basedn.ldif
you will be prompted to enter the LDAP-server password that you set during the installation.
Add User Accounts and Groups.
Generate a password for the user account to add.
sudo
slappasswd
Enter the new password and copy the password that starts with
{SSHA}
and keep it somewhere for later use.
Create ldif file for adding users
$
nano
ldapusers.ldif
version:
1
dn:
uid
=
jdoe,ou
=
people,dc
=
gspie,dc
=
lab
cn:
demo-user
gecos:
Jane
Doe
gidnumber:
5000
givenname:
Jane
homedirectory:
/home/jdoe
loginshell:
/bin/bash
mail:
jdoe@cisco.com
objectclass:
person
objectclass:
organizationalPerson
objectclass:
inetOrgPerson
objectclass:
posixAccount
objectclass:
top
objectclass:
shadowAccount
shadowlastchange:
19047
shadowmax:
99999
shadowwarning:
7
sn:
doe
uid:
jdoe
uidnumber:
10000
userpassword:
{
SSHA
}
....
Add the user account to the LDAP-server by running.
ldapadd
-x
-D
cn
=
admin,dc
=
gspie,dc
=
lab
-W
-f
ldapusers.ldif
Enter LDAP Password and hit enter.
Create ldif file for adding groups
sh
  $ nano ldapgroups.ldif
  dn: cn=jdoe,ou=groups,dc=gspie,dc=lab
  objectClass: posixGroup
  cn: jdoe
  gidNumber: 5000
  memberUid: jdoe
- To add the group, do the same as the user account.
ldapadd
-x
-D
cn
=
admin,dc
=
gspie,dc
=
lab
-W
-f
ldapgroups.ldif
How to install phpldapadmin on Ubuntu 20.04
¶
Step 1: Setup and install the software package
¶
To install the software package use the below command
apt-get
install
phpldapadmin
-y
After installing phpLDAPadmin, you will need to configure phpLDAPadmin and define your domain information by editing the file /etc/phpldapadmin/config.php
nano
/etc/phpldapadmin/config.php
Uncomment and change the following lines based on your ldap server information:
$servers
->setValue
(
'server'
,
'name'
,
'Gspie-ns1'
)
;
$servers
->setValue
(
'server'
,
'host'
,
'10.200.96.87'
)
;
$servers
->
;
setValue
(
'server'
,
'base'
,array
(
'dc=gspie,dc=lab'
))
;
$servers
->setValue
(
'login'
,
'auth_type'
,
'session'
)
;
$servers
->setValue
(
'login'
,
'bind_id'
,
'cn=admin,dc=gspie,dc=lab'
)
;
$servers
->setValue
(
'auto_number'
,
'min'
,array
(
'uidNumber'
=
>10000,
'gidNumber'
=
>10000
))
;
Save and close
Step 2: Configure Apache
¶
By default the phpLDAPadmin configuration file for Apache is located at /etc/apache2/conf-available/phpldapadmin.conf. Leave everything as it's, we will discuss how to add SSL cert in the
next section
.
Disable the default Apache virtual host configuration file and restart the Apache service to apply the changes
a2dissite
000
-default.conf
systemctl
restart
apache2
Now, open
http://your-server-ip/phpldapadmin
to access the UI.
How to add SSL cert on apache phpLDAPadmin
¶
prerequisite
¶
You will need to have the certificate and the key on hand before you proceed.
Here's the
guide
to request ssl key and cert.
Step 1: copy the ssl cert and key to the ubuntu server
¶
copy the certificate and the key to
/etc/apache2/ssl/
scp
ldap.crt
user@ldap-server:/etc/apache2/ssl/ldap.crt
scp
ldap.key
user@ldap-server:/etc/apache2/ssl/ldap.key
Step 2: make a  backup for the existing phpLDAPadmin configuration file
¶
copy
default-ssl.conf
to default-ssl.conf.bak
cp
default-ssl.conf
default-ssl.conf.bak
edit
default-ssl.conf
, to add the HTTPS configuration.
Sample output
$
nano
default-ssl.conf
Module
mod_ssl.c>
<VirtualHost
*:80>
ServerAdmin
webmaster@localhost
DocumentRoot
/var/www/html
ServerName
www.gspie-ns1.cisco.com
RewriteEngine
On
RewriteCond
%
{
HTTPS
}
!
=
on
RewriteRule
^/?
(
.*
)
https://%
{
SERVER_NAME
}
/
$1
[
R
=
301
,L
]
Redirect
/
https://gspie-ns1.cisco.com/phpldapadmin/index.php
ErrorLog
${
APACHE_LOG_DIR
}
/error.log
CustomLog
${
APACHE_LOG_DIR
}
/access.log
combined
</VirtualHost>
<VirtualHost
*:443>
ServerAdmin
ahismail@cisco.com
ServerName
gspie-ns1.cisco.com
ServerAlias
www.gspie.ns1.cisco.com
ErrorLog
${
APACHE_LOG_DIR
}
/error.log
CustomLog
${
APACHE_LOG_DIR
}
/access.log
combined
#   SSL Engine Switch:
#   Enable/Disable SSL for this virtual host.
SSLEngine
on
SSLCertificateFile
/etc/apache2/ssl/ldap.crt
SSLCertificateKeyFile
/etc/apache2/ssl/ldap.key
#SSLOptions +FakeBasicAuth +ExportCertData +StrictRequire
<FilesMatch
"\.(cgi|shtml|phtml|php)
$
"
>
SSLOptions
+StdEnvVars
</FilesMatch>
<Directory
/usr/lib/cgi-bin>
SSLOptions
+StdEnvVars
</Directory>
</VirtualHost>
</IfModule>
just to be sure enable the default site once again and restart apache
sh
  a2ensite default-ssl.conf
  /etc/init.d/apache2 restart
check the if everything is working by accessing
http://your-server-ip/phpldapadmin
, the traffic should redirect to https. to check the certificate click on the lock icon on the left corner of the browser address bar.
2023-02-16