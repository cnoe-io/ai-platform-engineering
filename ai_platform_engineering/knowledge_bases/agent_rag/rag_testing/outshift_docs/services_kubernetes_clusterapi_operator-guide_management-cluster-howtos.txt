Management Cluster Cheatsheet
Â¶
Set you kubectl context to a management cluster.
Lists the clusters under the management clusters control
kubectl get clusters
NAME           AGE   PHASE
eti-cc         92d   Provisioned
eti-gitops-1   86d   Provisioned
eti-gitops-2   27d   Provisioned
Lists the machines (control plane and worker nodes)
kubectl get machines
NAME                                 CLUSTER        AGE   PROVIDERID                                          PHASE     VERSION
eti-cc-control-plane-kd7xm           eti-cc         92d   openstack:///f61e3acd-089f-4c09-b965-abcbe149172b   Running   v1.21.3
eti-cc-md-0-85d55b9959-9ghpx         eti-cc         92d   openstack:///4b7e5700-9175-43f3-9c3c-43905e8df4b2   Running   v1.21.3
eti-cc-md-0-85d55b9959-fhksb         eti-cc         92d   openstack:///164dcaa4-6461-4940-8bd7-90644278da18   Running   v1.21.3
eti-cc-md-0-85d55b9959-p6gkl         eti-cc         92d   openstack:///6d57fa8e-c022-4e40-90d0-f93cfbbacd89   Running   v1.21.3
eti-gitops-1-control-plane-5trc7     eti-gitops-1   30d   openstack:///98f53bd2-c0bd-4a82-b436-02ea931ee34d   Running   v1.21.3
eti-gitops-1-control-plane-w4hzz     eti-gitops-1   27d   openstack:///b3ba8359-3d81-4b93-b796-e3d159f43fc5   Running   v1.21.3
eti-gitops-1-control-plane-x6cbj     eti-gitops-1   86d   openstack:///f828e367-810d-42e9-9d33-df35e3353f17   Running   v1.21.3
eti-gitops-1-md-0-6bd5dffb9f-8bh7r   eti-gitops-1   71d   openstack:///236eb92b-9bb7-46b1-8008-56a512ffcbd5   Running   v1.21.3
eti-gitops-1-md-0-6bd5dffb9f-8gkpb   eti-gitops-1   44h   openstack:///42cd002e-327c-4112-8b28-6a079e6c06e8   Running   v1.21.3
eti-gitops-1-md-0-6bd5dffb9f-j2qtn   eti-gitops-1   47h   openstack:///4bdc49d2-9d71-49d1-85f5-ca69fd906511   Running   v1.21.3
eti-gitops-2-control-plane-d8rs7     eti-gitops-2   27d   openstack:///87b2ae34-34fc-4a6c-9332-5adac387bc65   Running   v1.21.9
eti-gitops-2-control-plane-qd8pf     eti-gitops-2   27d   openstack:///6e1cf848-2fa4-47f9-beef-9dcf1cefe49c   Running   v1.21.9
eti-gitops-2-control-plane-wjfjm     eti-gitops-2   27d   openstack:///af9ad4c6-05ab-4280-ab97-54862123a5a8   Running   v1.21.9
eti-gitops-2-md-0-db466b999-6cngg    eti-gitops-2   27d   openstack:///493ee2c1-47a6-4227-9fa0-e0ead9ec9e67   Running   v1.21.9
eti-gitops-2-md-0-db466b999-m26kq    eti-gitops-2   46h   openstack:///90c930ae-87b5-4755-8fe3-5c20deff3206   Running   v1.21.9
eti-gitops-2-md-0-db466b999-t5zg4    eti-gitops-2   27d   openstack:///50223e27-0df5-497d-b4ce-dfbe2be19221   Running   v1.21.9
List the control planes
kubectl get kubeadmcontrolplanes
NAME                         AGE   INITIALIZED   API SERVER AVAILABLE   VERSION   REPLICAS   READY   UPDATED   UNAVAILABLE
eti-cc-control-plane         92d   true          true                   v1.21.3   1          1       1
eti-gitops-1-control-plane   86d   true          true                   v1.21.3   3          3       3
eti-gitops-2-control-plane   27d   true          true                   v1.21.9   3          3       3
Replace a dead host.  If you delete a machine, Cluster API will delete the resource in Openstack (if still there) and spin up a new host.  If the host is not there, it spins up a new host.
kubectl delete machine eti-gitops-2-md-0-db466b999-6cngg
Delete a cluster.
Note:
Be careful with this one.  This will delete instances, load balancer, security groups, router, network.
kubectl delete cluster <cluster-name>
Scaling up/down worker nodes.  Edit the machinedeployment resource and adjust the replicas.
kubectl edit machinedeployment eti-gitops-2-md-0
Scaling up the control plane.  This should never be needed.  Each cluster is created with 3 control plane replicas (instances).  Again, edit the replicas to scale up/down.  There is a issue currently with the scale down as it gets blocked because of etcd.
kubectl edit kubeadmcontrolplane eti-gitops-2-control-plane
2022-11-16