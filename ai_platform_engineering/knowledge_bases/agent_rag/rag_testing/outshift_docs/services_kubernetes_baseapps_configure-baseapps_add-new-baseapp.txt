add a new baseapp to baseapps-configs
uprade baseapp
Add new baseapp
â Chart Versioning
¶
ETI uses semver to customize third-party charts. ETI customized third-party app is versioned as
<Original Version>-<ETI Version>
Original version
: Upstream third-party version
ETI version
: ETI Customization version
Example:
A third-party chart with upstream version v0.0.1 with ETI customization will be version as v0.0.1-1
Step 1a. Create
Chart
¶
Create a third-party chart in sre-helm-chart with ETI specific version.
apiVersion
:
v2
name
:
new-thirdparty-service
description
:
new-thirdparty-service
type
:
application
version
:
0.0.1-1
appVersion
:
"0.1.1"
dependencies
:
-
name
:
new-thirdparty-service
version
:
0.1.1
repository
:
https://charts.new-thirdparty-service.io
ð
Note
Keep the
appVersion
and
version
as the same of the upstream Chart.yaml
Step 1b. Customize for ETI needs
¶
All customizations go under ./template folder
Example
âââ Chart.yaml
âââ templates
â âââ eti-es-access-tests.yaml
â âââ eti-es-clusterrolebinding.yaml
â âââ eti-es-clustersecretstores.yaml
â âââ eti-es-vault-sa.yaml
â âââ namespace.yaml
âââ values.yaml
Step 2: Publish Charts to Chart Museum
¶
sre-helm-charts are publish to ChartMuseum using sre-pipeline-library. Here is the
Jenkinsfile
sre-helm-charts pipeline job
ChartMuseum UI
Step 3a: Test the new baseapp.
¶
Modify the
sre-baseapp-configs
repo for the cluster it will be tested on.
Use the
Additional App
scenario within the
Baseapp Manifest
to deploy this baseapp to the cluster it will be tested on.
Create a new directory for the
values.yaml
to develop the values.
Example:
clusters/<target_cluster>/<new-base-app>/values.yaml
Step 4: Add baseapp to
kubernetes-baseapps
¶
Modify the baseapp tested in the previous step to the
values.yaml
of the
kubernetes-baseapps
helm chart.
Update the
baseapps_chart_version
in the
config.json
for deployment to clusters.
Use the
BaseApp Chart Version
section within the
Baseapp Manifest
to update the cluster.
Monitor ArgoCD Updates
¶
Upon completion of the source updates to
sre-baseapp-configs
ArgoCD will add the application to the cluster.
Navigate to the
kubernetes-baseapps
projectapp.
Navigate to the
<cluster_name>-baseapps
instance you expect the new baseapp to be.
Observe baseapp is added to the list of applications deployed to the cluster.
2023-10-17