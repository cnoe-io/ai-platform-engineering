2021-08-26-Harbor-outage
¶
When
¶
1106 EDT - 1408 EDT
Summary
¶
Harbor.eticloud.io reported down by Venture. Sri discovered the database pod not restarting. Sri dug into the problem and ran into an AWS bug. With some assistance from AWS support, we expanded the autoscaling group to include two new nodes, which restored service. We serially replaced the nodes with a new AMI.
Timeline
¶
2021-08-26
1106 EDT - Selina reports issues with harbor.eticloud.io. Sri begins trouble-shooting.
1244 EDT - Sri reports hitting AWS bug:\
https://github.com/aws/amazon-vpc-cni-k8s/issues/1340
1208 EDT - Sri starts talking with AWS support.
1330 EDT - Second node cordoned. ASG expanded with new nodes. Work starts replacing nodes with new AMI.
1407 EDT - Harbor recovered.
1424 EDT - Sri starts replacing nodes.
xxxx EDT - Sri completes replacing nodes.
####
Impact
\
System(s) impacted?
####
https://harbor.eticloud.io
\
Teams impacted?
Primarily AppNet.
Analysis
¶
Our alerting did not let us know that Harbor was down.
We had issues knowing how to access the eks production cluster via SSH.
Root causes appears to twofold:
A transient issue with the connection between the instance and the instance store.
A bug in EKS
.
Takeaways
¶
Monitoring needs to be adjusted to alert on the condition observed. More detail is needed on precisely what those conditions are is needed.
Documentation for accessing EKS clusters via SSH needs to be improved.
The EKS clusters needed to be upgraded.
The upgrade process of the EKS clusters needs to be planned and executed.
2022-05-12