scrape amp metrics
send metrics to amazon managed prometheus
send metrics to amp
How to scrape metrics and send them to Amazon Managed Prometheus
¶
!!! warning This documentation is deprecated, we are using splunk now for observability
Scraping of resources to the local prometheus occurs when the
opentelemetry.io/scrape: true
annotation is used
Annotation
¶
Annotate services, deployments, pods, and other workloads with the following annotation to have the metrics scraped by aws-opentelemetry-collector.
opentelemetry.io/scrape: true
Example Python code snippet
¶
from
prometheus_client
import
start_http_server
,
Counter
import
time
# Define your service name which includes team and app identifiers
app_name
=
"cspm-example-app"
# Create a counter metric with a label for the service name
example_counter
=
Counter
(
'app_example_counter'
,
'A simple example counter'
,
[
'app_name'
])
# Start an HTTP server on port 8000
start_http_server
(
8000
)
while
True
:
# Increment the counter with the service name label
example_counter
.
labels
(
app_name
=
app_name
)
.
inc
()
time
.
sleep
(
10
)
Kubernetes Resource Examples
¶
deployment
¶
apiVersion
:
v1
kind
:
Pod
# or Service, Deployment, StatefulSet...
metadata
:
annotations
:
opentelemetry.io/scrape
:
"true"
name
:
app-pod
namespace
:
test
spec
:
containers
:
-
image
:
my-image:1.0
name
:
app
ports
:
-
containerPort
:
8000
name
:
metrics
protocol
:
TCP
pod
¶
apiVersion
:
v1
kind
:
Pod
# or Service, Deployment, StatefulSet...
metadata
:
annotations
:
opentelemetry.io/scrape
:
"true"
name
:
app-pod
namespace
:
test
spec
:
containers
:
-
image
:
my-image:1.0
name
:
app
ports
:
-
containerPort
:
8000
name
:
metrics
protocol
:
TCP
Note
Metrics sent to Amazon Managed Prometheus are labeled with the cluster identification label
etip_source_cluster=<cluster_name>
. It is recommended to filter metrics with this label to identify the source cluster for the metric.
2025-06-20