Landscape
¶
ETI secrets management encompasses a number of types of secrets in various places outlined below.  We utilize short term role based access or tokens and restrictive policies to reduce the amount of exposure of Keeper (more on that later) and Cloud Service Provider resources.
Following sections will describe how the secrets are generated and where they are stored
CSP Acccess - Human
¶
Credential
Notes
CSP Root Management
Runon generated root account with MFA
Root account is a Cisco mailing list of admins. Initial password is emailed to the mailing list on account creation. Shared MFA is used to meet STO requirements
CSP everything
Cisco SSO (DUO) assumed role
Controlled by Cisco AD Groups
Hosts
SSH Keys retrieved from vault
SSH keys are created locally and stored in vault. For AWS Infra, SSH keys are uploaded to EC2 key pairs
Notes:
- Cisco AD Group access is managed via gitops workflow.
- SSH key creation is discussed in detail below.
CI Secrets
¶
Machine Account/Robot
Storage
Notes
ECR Registry Push
Jenkins library retrieves IAM from Vault AWS secret engine
Keeper
Github
Cisco generic user creds stored in Jenkins credential management
Jenkins creds
Cisco Generic Users
Internal Registry (Artifactory)
Cisco generic user creds stored in Jenkins credential management
Jenkins creds
Cisco Generic Users
Compliance Tools
Cisco generic user creds stored in Jenkins credential management
Jenkins creds
Cisco Generic Users
Ansible host automation
SSH Keys retrieved from vault
Keeper
SSH keys
Integration Tests
CSP/IAM creds retrieved from vault
Keeper
Integration tests use a temporary vault token which generates ephemeral IAM credentials using vault aws engine.
Note:
- On-going work to replace static IAM user-type creds to IAM assume-role creds.
Deployment Secrets
¶
Machine Account/Robot
Storage
Notes
Atlantis (terraform gitops)
Static IAM credentials
Keeper
ClusterAPI
Cisco generic users stored in vault
Keeper
Cisco Internal Openstack
ArgoCD
k8s auth
k8s etcd
Application Secrets
¶
Credential Type
Storage
Notes
AWS CSP resources
Web Identity Role
N/A
Accessing AWS Resource from k8s
Database/API Token
Static creds
Keeper
External Secrets in Kubernetes
User secrets
Customer supplied creds
External secrets manager
Documentation
¶
ETI Vault/Keeper Docs
ETI Pipeline Token Rotation
ETI Venture Pipeline Token Rotation
External Secrets in Kubernetes
Banzai ImagePullSecrets
Accessing AWS Resource from k8s
Keeper
¶
Cisco Crypto Services team implemented an enterprise instance of HashiCorp's Vault. Teams request namespace(s) within Keeper for secret storage and retreival.  For more infromation about
Introduction to Keeper wiki
ETI SRE's Keeper Namespace
Background Presentations
¶
Secrets Management done right in CI/CD
presentation done by Sri Aradhyula
Deep Dive into Kubernetes Secrets
presentation done by MÃ¡rk SÃ¡gi-KazÃ¡r
2023-09-03