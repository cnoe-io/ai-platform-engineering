SRE-7343: Kyverno Cluster Policy Deployment
¶
This document outlines the steps required to deploy the Kyverno Cluster Policy. It includes preparation, execution, post-validation, policy configuration, and a rollback plan in the event of any issues.
SRE-7343: Kyverno Cluster Policy Deployment
Preparation Steps
Execute Change
Post-Validation
Policy Configuration
Roll-Back
Preparation Steps
¶
Review the changes that need to be promoted to production. Ensure that the new application version and helm chart have been validated in the staging environment.
Create Pull Requests (PRs) for deploying the new application version and helm chart.
PR to Baseapps CNAPP
Ensure that the Helm package dependencies are met:
The
kyverno-cluster-policies
depend on the
kyverno
Helm package. Verify that
kyverno
is installed and configured correctly before proceeding.
Communicate the intended changes to all relevant stakeholders and prepare them for the upcoming deployment.
Confirm that a backup plan and rollback procedure are in place and ready to be executed if necessary.
Execute Change
¶
Post a notice in the ET&I Platform Status space about the changes we are going to enforce, including the time of change and expected impacts, if any.
Merge the PR to update the baseapps configuration and trigger ArgoCD synchronization:
kyverno
:
exclude
:
false
kyverno-cluster-policy
:
exclude
:
false
version
:
0.1.8
Monitor the deployment process through ArgoCD dashboard or CLI to ensure successful application of the Kyverno policy.
Post Validation
¶
Verify that the Kyverno Cluster Policy has been successfully deployed and is operational.
Check the ArgoCD dashboard or use the CLI to ensure that the deployed resources match the desired state defined in the git repository.
Perform any additional checks to ensure the policies are being enforced as expected.
Update the ET&I Platform Status space with the successful deployment notice.
Policy Configuration
¶
Once the Kyverno Cluster Policy is deployed, you will need to configure the policies based on the
README.md
in each of the policies within the
kyverno-cluster-policy
repository.
Navigate to the kyverno-cluster-policy repository and review the
README.md
for each policy to understand the configuration requirements.
Apply the necessary configurations as per the policy documentation, ensuring that the policies are customized to meet the organization's requirements.
Test the configured policies in a controlled environment to confirm that they behave as intended before applying them in production.
Roll-Back
¶
If issues are encountered during the deployment or policy configuration, follow these steps to revert to the previous configuration:
Update the baseapps configuration to exclude the Kyverno Cluster Policy, setting
exclude: true
, and submit a PR for the rollback.
Merge the rollback PR to restore the previous state and trigger a synchronization with ArgoCD:
kyverno-cluster-policy
:
exclude
:
true
Monitor the rollback process through the ArgoCD dashboard or CLI to ensure the Kyverno service is removed from the cluster.
Communicate the rollback to all stakeholders and update the ET&I Platform Status space with the status of the rollback.
2024-02-20