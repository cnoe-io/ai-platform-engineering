in-cluster vault access
vowel cluster vault access
Vowel in-cluster vault access
¶
Testing this on developer's desktop
¶
Step 1: Login to Keeper
¶
export VAULT_ADDR=https://keeper.cisco.com
export VAULT_NAMESPACE=eticloud/apps/vowel
export VAULT_TOKEN=$(vault login -method=oidc -format=json | jq -r .auth.client_token)
Sample Output:
Complete the login via your OIDC provider. Launching browser to:
https://sso-dbbfec7f.sso.duosecurity.com/oidc/FOO/authorize?client_id=BAR
Step 2: Setup port-forwarding to vault
¶
kubectl port-forward svc/vowel-dev-1-vault-dev -n vowel-dev 8200:8200
Step 3: Retrieve Vault Token for Cluster Vault
¶
export VAULT_TOKEN=$(vault kv get -field=root-vault-token secret/dev/vault)
export VAULT_NAMESPACE=root
export VAULT_ADDR=http://127.0.0.1:8200
Step 4: Create vault secrets and retrieve it
¶
Create secret
¶
vault kv put secret/foo bar=buz
Sample Output:
= Secret Path =
secret/data/foo
======= Metadata =======
Key                Value
---                -----
created_time       2023-10-26T18:24:56.057539843Z
custom_metadata    <nil>
deletion_time      n/a
destroyed          false
version            1
Retrieve secret
¶
vault kv get secret/foo
Sample Output:
= Secret Path =
secret/data/foo
======= Metadata =======
Key                Value
---                -----
created_time       2023-10-26T18:24:56.057539843Z
custom_metadata    <nil>
deletion_time      n/a
destroyed          false
version            1
=== Data ===
Key    Value
---    -----
bar    buz
In-cluster VAULT ACCESS
¶
VAULT_ADDR
VAULT_NAMESPACE
VAULT_TOKEN
Dev
http://vowel-dev-1-vault-integration.vowel-integration.svc:8200
root
https://keeper.cisco.com/ui/vault/secrets/secret/show/dev/vault?namespace=eticloud%2Fapps%2Fvowel
Integration
http://vowel-dev-1-vault-dev.vowel-dev.svc:8200
root
https://keeper.cisco.com/ui/vault/secrets/secret/show/integration/vault?namespace=eticloud%2Fapps%2Fvowel
Setup External Secret with the above values
2023-10-26