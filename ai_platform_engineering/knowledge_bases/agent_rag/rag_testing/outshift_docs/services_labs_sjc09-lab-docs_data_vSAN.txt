vSAN
How to setup vSAN cluster in vSphere
¶
This guide explains the step-by-step process on how to create vSAN cluster in vSphere.
Prerequisite
¶
vCenter server
vSAN hardware requirements
.
Step 1: Setup vSAN cluster networking configurations
¶
Let's start configuring the networking first, So that when we enable the vSAN setting later we have the networking already in placed and will not worry about having any connection issues.
Add a new
distributed switch
if you don't have one already.
Add the
esxi hosts
to the new vSphere distributed switch.
Create a new portGroup in the distributed switch.
Go to the networking in the vSphere client.
Right click on the vSphere Distributed switch and click on new port group
Enter the port group name (vSAN-network),Select number of port and enter the VLAN.
Click finish to create a new port group with desired vlan.
Add a VMkernel Network Adapter on each esxi host in the vSAN cluster.
Go to each  of your esxi hosts in the vSphere client then navigate to Configure.
In the networking section, go to
VMkernel adapters
and click on
ADD NETWORKING
Choose
Next
,
Select an existing Network
,
Next
and check
vSAN
checkbox.
Choose
Next
, Specify VMkernel IPv4 setting and finish.
Step 2: Create vSAN cluster and add the esxi hosts
¶
Follow this
guide
to create a vSAN cluster in the vCenter UI.
Drag and drop the esxi hosts to the  vSAN cluster.
Step 3:  Disk Groups
¶
Before you create disk-groups make sure that your hosts has the required disks, so the vSAN cluster will be able to detect your disks.
Go to the CIMC on each of the vSAN hosts (if you are not using UCS manager) and create two virtual disks, one for the cache tier and one for the capacity tier.
Create
RAID
with desired RAID level; I prefer using RAID0 for dev environments.
Troubleshooting tips
¶
In the event that you don't see your disks in vSAN Disk Management section:
Go to each  of your esxi hosts in the vSphere client then navigate to Configure.
Choose
Storage Adapters
in
storage
section, click on Modular Raid Controller adapter and choose
Devices
at the bottom section.
You will see the disks that's attached to the UCS server, select the disk you desired and click on
ERASE PARTITIONS
.
To Mark Devices as Flash follow this
guide
Navigate to this
guide
to create disk group
Step 4: Skyline health-check
¶
After you create the vSAN disk group, check the vSAN cluster health:
Navigate to the vSAN cluster, then choose monitor tab.
Scroll down and choose
skyline health
in the vSAN section.
Scroll over the health-checks and fix if there are any health-check errors. To learn more about why a specific health-check is being triggered, click on it and in the right pane it will give a brief overview. Click on Info tab for more information.
2023-02-16