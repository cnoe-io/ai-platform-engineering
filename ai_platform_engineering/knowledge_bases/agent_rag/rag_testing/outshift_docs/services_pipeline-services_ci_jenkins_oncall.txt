On-call
¶
Jenkins Emergency Contacts
Playbooks
How to open a case with EngIT
How to recover Jenkins Bread Crumb issue?
How to set up approved folder for Jenkins master node
How to monitor Jenkins Master disk space Usage
How to generate a One time Password (OTP) for Jenkins nodes
Rotate Jenkins Vault Token With Admin Privilege
How to resolve a job hanging on
docker pull <image>
How to resolve disk usage alerts for "cloud-node" agents
Scaling Jenkins Cloud Agents
Jenkins Build Agent Clean-up Jobs
Monitoring
Jenkins Emergency Contacts
¶
Mailer:
engit-ci-support@cisco.com
Engineer ET&I SRE team works with regularly:
Vinay Puthiyedath (vputhiye)
Playbooks
¶
How to open a case with EngIT
¶
Open a case with EngIT
Service Offering:
Jenkins
Category:
Select as appropriate
Notes:
Provide as much detail as possible
Location:
SJC
How to recover Jenkins Bread Crumb issue?
¶
Reference:
https://stackoverflow.com/a/60386839
What:
ET&I Pipeline library uses code to post to Jenkins without a Crumb. This is a workaround and needs to be fixed in the future.
Issue:
Jenkins uses CSRF protection. A Jenkins user or administrator visiting some other website would allow the operator of that site to perform actions in Jenkins as the victim.Â
https://www.jenkins.io/doc/book/security/csrf-protection/
Work-around:
Disable SessionToken/Crumb Validation
Install Strict Crumb Issuer plugin:
Uncheck "Check Session ID":
How to set up approved folder for Jenkins master node
¶
How to monitor Jenkins Master disk space Usage
¶
We monitor Jenkins master disk space usage with a Prometheus plugin and trigger an alert if the usage is more than 600 GB out of 750 GB total.Â  Historical data can be viewed from
here
.
How to generate a One time Password (OTP) for Jenkins nodes
¶
Get the Jenkins node IP:
ping
eti-jenkins-common-large-1
Export required environment variables:
export
VAULT_NAMESPACE
=
eticloud/eticcprod
export
VAULT_TOKEN
=
<YOUR
Vault
token>
...or, on macOS, to avoid pasting directly into the terminal and after copying the token from Vault:
export
VAULT_TOKEN
=
`
pbpaste
`
Update Vault:
vault
write
ssh/creds/otp_key_role
ip
=
<IP
from
Ping>
Rotate Jenkins Vault Token With Admin Privilege
¶
Navigate to this Jenkins Job
âââââââ
Select
RECREATE_TOKENS_AND_POLICIES
Copy your
vault_admin
Vault Token
Paste your token when the job prompts
How to resolve a job hanging on
docker pull <image>
¶
Symptom:
Docker runtimes occasionally get into a state that causes a valid
docker pull
command to hang indefinitely.
Resolution:
SSH to the Jenkins node
executing the impacted job
Restart docker by running:
sudo
systemctl
restart
docker
How to resolve disk usage alerts for "cloud-node" agents
¶
Example page:
Alert [FIRING:1] BlackboxProbeFailed-Prod eti-sre-monitoring.cisco.com https://engci-private-sjc.cisco.com/jenkins/eti-sre/metrics/[...]/healthcheck?pretty=true blackbox_jenkins critical
Note that the link shows a message like the following for
temporary-space: Only 0.987 Gb free on eti-cloud-node-1
SSH to the alerting cloud-node agent
Run
df -h
to check disk usage
If root disk is full, try running:
sudo
docker
system
prune
-a
--filter
"until=1h"
sudo
docker
volume
prune
-a
If the above frees > 20% disk space, wait for the page to auto-resolve.
If the disk is still >80% full after running the above, try running:
sudo
du
-Sh
/
|
sort
-rh
|
head
-5
...to get top 5 disk space hogging files. Example output:
ubuntu@ip-172-31-95-129:~$
sudo
du
-Sh
/
|
sort
-rh
|
head
-5
771M
/tmp/stereoscope-cache952642257
771M
/tmp/stereoscope-cache890432083
771M
/tmp/stereoscope-cache4028835865
771M
/tmp/stereoscope-cache3579788561
771M
/tmp/stereoscope-cache3558131639
In the above case, one of the build jobs is leaving files behind in
/tmp
. To resolve this:
Wait for node to become idle (no running jobs)
Mark node as offline
Reboot the node by running
sudo shutdown -r
When node is back online, re-mount volume:
sudo mount /dev/nvme1n1 /mnt
Mark node as online
If the above frees >20% disk space, wait for page to auto-resolve
Scaling Jenkins Cloud Agents
¶
See
Scaling Cloud Worker Nodes
Jenkins Build Agent Clean-up Jobs
¶
Alerts exist
here
for monitoring
the job
which cleans up disks on the various Jenkins build agents.
Specifically, the
SreBuildInfraAnsibleJobFailing
and
SreBuildInfraAnsibleJobNotRunning
alerts indicate that
the job
is either failing or has not run in the specified interval.
If
the job
does not run for an extended period of time, the disks on the build agents will begin to fill up, which will eventually lead to "disk full" alerts later on.
To resolve, check
the job's
status. Restart and/or troubleshoot it as required so it can run again.
Monitoring
¶
See
Jenkins CI Dashboards
2024-07-11