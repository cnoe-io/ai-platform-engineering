registry.eticloud.io robot account auth issues
¶
When:
2022-04-22, 14.12 - 15.45 PM US Central Time (GMT-6)
Summary:
registry.eticloud.io robot accounts were unable to authenticate
Impact:
Users were unable to pull container from registry.eticloud.io using robot accounts
Timeline:
4/22/22 14:12 CST: Shannon McFarland reported that registry.eticloud.io in "Appnet leads" webex space
7/22/21 14:23 CST: Reinhardt responded and asked for further clarification. Reinhdardt and Sri was doing a 1:1 at the same time and reproduce the issue.
7/22/21 15:34 CST: Reinhardt communicated back that SRE team is working on the issue
7/22/21 15:34 CST: Sri Aradhyula updated the
ETI Platform Status
space about the outage
7/22/21 15:34 CST: Sri Aradhyula identified a recent configmap change and issued a restart rollout of deployments
7/22/21 15:34 CST: Sri Aradhyula verified with Shannon that the issue is fixed
Analysis:
¶
An operator config
change
was rolled out on April 22
nd
2022
Harbor core pods were not restarted so they were out of sync
There is a
known issue
in harbor operator
Resolution:
¶
Issue a restart rollout of deployments
# Get harbor deployments
â¯ kubectl get deployments -n harbor
NAME                               READY   UP-TO-DATE   AVAILABLE   AGE
harbor-harbor-harbor-chartmuseum   1/1     1            1           64d
harbor-harbor-harbor-core          1/1     1            1           64d
harbor-harbor-harbor-exporter      1/1     1            1           64d
harbor-harbor-harbor-jobservice    1/1     1            1           64d
harbor-harbor-harbor-portal        1/1     1            1           64d
harbor-harbor-harbor-registry      1/1     1            1           64d
harbor-harbor-harbor-registryctl   1/1     1            1           64d
rfs-harbor-redis                   1/1     1            1           64d
# Rollout Restart harbor deployments
kubectl -n harbor rollout restart $(kubectl -n harbor get deploy -o name)
Takeaway:
¶
Added
harbor integration testing
. To validate
registry login with robot accounts
registry pull containers
Remember to restart harbor pods after configmap changes
2022-05-05