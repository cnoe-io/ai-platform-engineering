ET& Websites Operator Guide
¶
Disaster Recovery Plan for websites using RDS
Restricted Access
Disaster Recovery Plan for websites using RDS
¶
The following is an outline of recovering a website that is utilizing Aurora Postgres such as eti.cisco.com and is also utilizing CloudFront for blue/green and a/b deployments. Steps below are using the
eti-staging.cisco.com staging
as an example.  The current RDS Aurora instance is rds-prod-1 for staging.  For this DR, it is unavailable and must be replaced.
Create a new RDS aurora instance, rds-prod-2.  The instance would be defined in the
sre-tf-infra in us-east-2
Restore from the snapshot as outlined
here
Update the secret for the db creds to point to the new rds-prod-2.  For
ACTUAL DR
, update the
db-creds
and create a new version.  For a
DR EXERCISE
, create a new secret in
eticloud/apps/websites
for staging-DR/eti-cisco-com/db-creds and point at the new DB.
Create a new
deployment for a
(right now there is c/d, so create an a. No need for b unless this is an actual
DISASTER
)
Update the
DATABASE_URL
in your eti.cisco.com-deployment/overlays/eti-website-app/staging/blue/a to use the new secret
Create a PR and merge the new deployment.  Sync the applicationset in
ArgoCD
and wait for the new a deployment to get created.
Verify the
https://eti-blue-a.staging.eticloud.io/
IF THIS IS ACTUAL DISASTER
- update the CloudFront with the new deployments a/b and remove the c/d, verify the staging.eticloud.io
Change the origins to add the new origin-a and origin-b
Create a new group, group_ab and then flip the behavior to the new origin and group
IF THIS IS A DR EXERCISE
- need to clean up
Once verified, will need to remove the deployment
Remove the secret
Remove the RDS aurora instance, rds-staging-2
Restricted Access
¶
Export Control via ALB and WAF
Export Control via CloudFront and WAF
Cisco internal access via CloudFront and WAF
2023-08-29