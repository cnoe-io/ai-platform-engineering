codeartifact cross-account sharing
Code Artifact Cross Account Sharing
¶
Setup Domain Control Policy
¶
CodeArtifact supports using resource-based permissions to control access
Create or Edit the "Domain Policy
Add the following policy to share resources with another account
{
"Version": "2012-10-17",
"Statement": [
{
"Sid": "ContributorPolicy",
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::958653173565:root"
},
"Action": [
"codeartifact:Describe*",
"codeartifact:Get*",
"codeartifact:List*",
"codeartifact:ReadFromRepository",
"codeartifact:DescribeDomain",
"codeartifact:GetAuthorizationToken",
"codeartifact:GetDomainPermissionsPolicy",
"codeartifact:ListRepositoriesInDomain",
"sts:GetServiceBearerToken"
],
"Resource": "*"
}
]
}
Setup Identity Policy
¶
Setup AWSCodeArtifactReadOnlyAccess policy on the Account where Code Artifact is used
{
"Version": "2012-10-17",
"Statement": [
{
"Action": [
"codeartifact:Describe*",
"codeartifact:Get*",
"codeartifact:List*",
"codeartifact:ReadFromRepository"
],
"Effect": "Allow",
"Resource": "*"
},
{
"Effect": "Allow",
"Action": "sts:GetServiceBearerToken",
"Resource": "*",
"Condition": {
"StringEquals": {
"sts:AWSServiceName": "codeartifact.amazonaws.com"
}
}
}
]
}
Verify Access
¶
genie-sdk
(base) ubuntu@ip-10-3-11-74:~$ aws codeartifact login --tool pip --domain outshift --domain-owner 626007623524 --repository genie-genie-ai-private --region us-east-2
Successfully configured pip to use AWS CodeArtifact repository https://outshift-626007623524.d.codeartifact.us-east-2.amazonaws.com/pypi/genie-genie-ai-private/
Login expires in 12 hours at 2024-08-19 09:54:25+00:00
(base) ubuntu@ip-10-3-11-74:~$ pip install genie
Looking in indexes: https://aws:****@outshift-626007623524.d.codeartifact.us-east-2.amazonaws.com/pypi/genie-genie-ai-private/simple/
Collecting genie
Downloading https://outshift-626007623524.d.codeartifact.us-east-2.amazonaws.com/pypi/genie-genie-ai-private/simple/genie/24.7/genie-24.7-cp312-cp312-manylinux2014_x86_64.whl (29.1 MB)
ââââââââââââââââââââââââââââââââââââââââ 29.1/29.1 MB 74.6 MB/s eta 0:00:00
Collecting PrettyTable (from genie)
Downloading https://outshift-626007623524.d.codeartifact.us-east-2.amazonaws.com/pypi/genie-genie-ai-private/simple/prettytable/3.11.0/prettytable-3.11.0-py3-none-any.whl (28 kB)
Requirement already satisfied: tqdm in ./miniconda3/lib/python3.12/site-packages (from genie) (4.66.2)
Collecting dill (from genie)
Using cached https://outshift-626007623524.d.codeartifact.us-east-2.amazonaws.com/pypi/genie-genie-ai-private/simple/dill/0.3.8/dill-0.3.8-py3-none-any.whl (116 kB)
pi-python-sdk
(base) ubuntu@ip-10-3-11-74:~$ aws codeartifact login --tool pip --domain outshift --domain-owner 626007623524 --repository ai-promptintel-python-private --region us-east-2
Successfully configured pip to use AWS CodeArtifact repository https://outshift-626007623524.d.codeartifact.us-east-2.amazonaws.com/pypi/ai-promptintel-python-private/
Login expires in 12 hours at 2024-08-19 10:10:04+00:00
(base) ubuntu@ip-10-3-11-74:~$ pip install pi-python-sdk
Looking in indexes: https://aws:****@outshift-626007623524.d.codeartifact.us-east-2.amazonaws.com/pypi/ai-promptintel-python-private/simple/
Collecting pi-python-sdk
Downloading https://outshift-626007623524.d.codeartifact.us-east-2.amazonaws.com/pypi/ai-promptintel-python-private/simple/pi-python-sdk/0.3.0/pi_python_sdk-0.3.0-py3-none-any.whl (75 kB)
ââââââââââââââââââââââââââââââââââââââââ 75.9/75.9 kB 3.6 MB/s eta 0:00:00
Requirement already satisfied: grpcio>=1.64.1 in ./miniconda3/lib/python3.12/site-packages (from pi-python-sdk) (1.65.5)
Requirement already satisfied: protobuf>=4.25.3 in ./miniconda3/lib/python3.12/site-packages (from pi-python-sdk) (5.27.3)
INFO: pip is looking at multiple versions of pi-python-sdk to determine which version is compatible with other requirements. This could take a while.
Downloading https://outshift-626007623524.d.codeartifact.us-east-2.amazonaws.com/pypi/ai-promptintel-python-private/simple/pi-python-sdk/0.2.2/pi_python_sdk-0.2.2-py3-none-any.whl (74 kB)
ââââââââââââââââââââââââââââââââââââââââ 74.6/74.6 kB 3.4 MB/s eta 0:00:00
Downloading https://outshift-626007623524.d.codeartifact.us-east-2.amazonaws.com/pypi/ai-promptintel-python-private/simple/pi-python-sdk/0.2.1/pi_python_sdk-0.2.1-py3-none-any.whl (77 kB)
ââââââââââââââââââââââââââââââââââââââââ 77.0/77.0 kB 9.2 MB/s eta 0:00:00
Installing collected packages: pi-python-sdk
Successfully installed pi-python-sdk-0.2.1
References
¶
https://docs.aws.amazon.com/codeartifact/latest/ug/domain-policies.html
https://docs.aws.amazon.com/codeartifact/latest/ug/security_iam_id-based-policy-examples.html#security_iam_id-based-policy-examples-console
2024-08-18