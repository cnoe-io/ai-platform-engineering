Sandbox VM Creation in vSphere (Terraform)
¶
This document provides a step-by-step guide on how to create a VMWare vSphere Sandbox in one of the ET&I Labs using Terraform.
Note: The process described here is an automated process that leverages Terraform. The ET&I SRE team recommends using this approach when possible; There is a Terraform module available  now that supports creating GPU-equipped VMs. To create these, see
Sandbox GPU VM Creation in vSphere
.
Overview
GitOps Workflow
VMware Data Centers
How to Create a VM
Step 1: Clone the
sre-vmware-sandbox
Repo
Step 2: Navigate to the Desired Data Center
Step 3: Make Changes to Configure the Desired VM Specs
Step 4: Checkout a New Branch
Step 5: Push to a PR and Apply via Atlantis
Step 6: Add the VM Information to eti-inventory
Overview
¶
GitOps Workflow
¶
ET&I SRE team uses the GitOps workflow via Atlantis to manage operations for VMware sandboxes.
VMware Data Centers
¶
We have two VMware environments:
SJC-09 vCenter
PIRL vCenter
How to Create a VM
¶
Step 1: Clone the
sre-vmware-sandbox
Repo
¶
git
clone
https://wwwin-github.cisco.com/eti/sre-vmware-sandbox.git
Step 2: Navigate to the Desired Data Center
¶
Go to the
datacenter
directory and choose the data center you wish to use. (SJC-09 or PIRL)
Step 3: Make Changes to Configure the Desired VM Specs
¶
Navigate to
/datacenter/[DC-name]/[vsphere-cluster-name]/vm/[infra or dev]
Make a copy from any existing vm tf file and rename it based on your new vm-name.\
  For example, copy
demo.tf
and rename it to
eti-[instance-name]-1.tf
.
Edit the file; in the
sre-vmware-module
section, configure the desired VM specs, such as CPU, Memory, etc.
Change the S3 backend key/value based on your instance name.
For example:
terraform
{
backend
"s3"
{
bucket
=
"tfstate-vmware-sjc"
key
=
"tfstate-build/[instance-name].tfstate"
region
=
"us-east-2"
}
}
Step 4: Checkout a New Branch
¶
Checkout a new branch; the branch name should match that of the Jira ticket number
For example:
git
checkout
-b
SRE-XXXX
Step 5: Push to a PR and Apply via Atlantis
¶
Push the changes up to GitHub, create a new PR and request a peer review.
Interact with Atlantis to plan and apply the changes as explained
here
.
You can find the credentials of the new created VM here in
Vault
.
Step 6: Add the VM Information to eti-inventory
¶
After creating the VM, be sure to add the resource's information to
racktables
. The credentials are available in
Vault
.
2023-08-29