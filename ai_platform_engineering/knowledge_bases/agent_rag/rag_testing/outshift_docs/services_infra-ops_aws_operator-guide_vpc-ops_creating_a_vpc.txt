Creating a VPC
¶
This document outlines the process for creating a new VPC using the ET&I Sandbox platform. For an overview of this architecture and/or when/why you should use it, here is a list of additional relevant documents:
Overview
VPC Diagram
Module
¶
SRE Module
¶
Source for SRE's version of this Terraform module:
sre-tf-module-aws-vpc
Public Module
¶
The SRE module is an abstraction wrapped around the public Terraform registry module
terraform-aws-vpc
. Note that we are pinned to a specific version of this module; check
this file
to determine the version we are using.
Example
¶
An example terraform configuration with more thorough explanations of the available options can be found in the
VPC Module Example
. The example is designed to be copied into another repository with modifications.
Latest Version
¶
See
tags
for the latest version of the SRE VPC module.
Pre-requisites
¶
Repository
¶
A GitHub repository based on the
template
must exist. This repository must have the proper permissions and webhook configured so as to enable the Atlantis bot to function. See
this doc
for specific guidance and/or examples regarding how to set this repository up if it does not already exist.
Amazon Web Services
¶
Before creating a VPC in a region that has never had a VPC before, you must confirm that Availability Zones have been enabled:
aws
ec2
describe-availability-zones
--region
<target-region>
This command will return some json listing what zones (if any) are configured within this region. If no zones are enabled, contact SRE for assistance.
Creating a new VPC
¶
If you have not already done so, create and/or clone the repository (as identified in the
Pre-requisites
section) and create a new branch within it. See
this doc
for specific guidance and/or examples.
Within the new branch, create a directory structure for the new Terraform configuration:
Pattern:
<cloud>-<account>/<service>/<region>/<resource-name>/<resource>.tf
Example:
aws-eticloud-scratch/vpc/us-east-2/sre-dev-3/vpc.tf
Copy the
example
vpc.tf
into the new resource directory created in the previous step.
Modify the new
vpc.tf
file created in the previous step. See
this doc
for specific guidance and/or examples.
Add and/or modify project configuration in the repo's
atlantis.yaml
file as required. See
this doc
for specific guidance and/or examples.
Create a Pull Request within GitHub for the changes made above.
Interact with Atlantis to
plan
and
apply
the changes as explained in the final steps
here
, thus creating the new infrastructure.
Post Creation Actions
¶
Update
Active Resources
VPC table.
Create a new page in the Current Resources
Current Resources
section.
2023-11-09