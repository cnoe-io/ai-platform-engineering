git lfs
GIT LFS Setup and Usage
¶
Overview
¶
Git LFS (Large File Storage)
1
is a Git extension to reduce the impact of large files in your repository by downloading files during checkout process rather than during cloning or fetching from git.
Reference
gitlfs.cisco.com
is a Cisco-hosted large file storage service which helps you to separate your large binary files and your source code.
Reference
Uses JFrogâs Artifactory to store large files
ET&I SRE team has created the
eti-gitlfs
project for general use within ET&I. See
Pre-requisites
.
sre-pipeline-library implementation in your Jenkinsfile
Setup
¶
Summary
¶
Git LFS doesn't support file transfer over SSH
Git LFS uses HTTP basic auth to do file transfer
Setup GIT LFS Credentials
¶
Pre-requisites
¶
User must be added to the
eti-gitlfs-rw
AD Group to be able to read/write to the
eti-gitlfs
project.
Step 1: Retrieve Artifactory API Key
¶
Login to
https://gitlfs.cisco.com/artifactory/webapp/#/login
Click on your username on the upper right corner (
Welcome, <username> (Logout)
)
Enter your CEC Password for
Current Password
to unlock your Authentication Settings
Click on
Generate API Key
Copy your API Key
Step 2. Create git-credentials file on desktop
¶
Edit or create
~/.git-credentials
on user's desktop
â¯
cat
~/.git-credentials
https://<USERNAME>:<APIKEY>@gitlfs.cisco.com
2. Make credentials only accessible by your user
chmod
600
~/.git-credentials
Step 3. Add git-credentials to gitconfig
¶
Create or Edit
~/.gitconfig
with the following content
[credential "https://gitlfs.cisco.com/artifactory/api/lfs/eti-gitlfs"]
helper = store --file ~/.git-credentials
Example:
[credential "https://gitlfs.cisco.com/artifactory/api/lfs/eti-gitlfs"]
helper = store --file ~/.git-credentials%
Step 4. Verify
¶
Please clone this test repo to verify your git lfs access:
https://wwwin-github.cisco.com/eti/lfs-test
The clone command should succeed, and you should be see the following contents of
foo.txt
and
baz.txt
files in that repo:
â
cat
foo.txt
foo
â
cat
baz.txt
baz
Track large files to push to git lfs
¶
Step 1. Install & set up git lfs for your git repo
¶
For example, to set up git lsf for the
https://wwwin-github.cisco.com/eti/lfs-test
repo:
git
clone
https://wwwin-github.cisco.com/eti/lfs-test
cd
lfs-test
git
lfs
install
git
config
-f
.lfsconfig
lfs.url
https://gitlfs.cisco.com/artifactory/api/lfs/eti-gitlfs
git
lfs
track
'*.txt'
# specify the files you want to track with git lfs
Step 2. Add and locally commit the large files for git lfs
¶
For example, to push a file named
foo.txt
:
echo 'foo' > foo.txt  # in most cases, user will copy large files into the current directory
git add foo.txt
git add .gitattributes .lfsconfig
git commit -m 'chore: add foo.txt'
git push
Optional: If you already have files tracked by git that you want to move to gitlfs
¶
git lfs migrate import --include="*.txt" --include-ref=refs/heads/main  # use the appropriate file extension
Step 3 [Optional]: Set expiration of old objects that have been migrated to gitlfs to remove them from git history (and shrink your repo)
¶
Note
: This step requires re-writing your git history to remove the large files that had been previously committed.
git
reflog
expire
--expire-unreachable
=
now
--all
git
gc
--prune
=
now
git
push
-f
References
¶
Git LFS
Git LFS Getting Started
Git LFS wiki
Git LFS migration
2023-08-01