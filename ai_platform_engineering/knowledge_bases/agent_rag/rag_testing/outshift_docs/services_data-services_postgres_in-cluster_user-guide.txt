User guide
¶
Postgres operator
must be present on the Kubernetes cluster in order to use the service.
Ask your SRE contact if it's already available on your cluster.
Installation
¶
For all available parameters and more examples check out the
official documentation
for the Postgres Operator.
The most basic Postgres installation can be achieved by applying the following custom resource on the cluster:
apiVersion
:
"acid.zalan.do/v1"
kind
:
postgresql
metadata
:
# Name has to start with the teamId
name
:
myteam-test-db
spec
:
# teamId is mandatory
teamId
:
myteam
volume
:
size
:
10Gi
numberOfInstances
:
1
users
:
# Create a user with priviletes
myuser
:
-
superuser
-
createdb
databases
:
# Create a database
mydb
:
myuser
postgresql
:
version
:
"14"
parameters
:
password_encryption
:
scram-sha-256
This could be part of your deployment config (eg. Helm chart) or you could apply it through ArgoCD.
Don't apply it manually unless it's absolutely necessary!
When in doubt, ask your SRE contact.
You will find the credentials for the created user in a Secret named
myuser.myteam-test-db.credentials.postgresql.acid.zalan.do
.
You can connect to the Postgres instance from your application at
myteam-test-db
on port
5432
.
If you apply the resource above through ArgoCD make sure to add the following annotations:
apiVersion
:
"acid.zalan.do/v1"
kind
:
postgresql
metadata
:
name
:
myteam-test-db
annotations
:
argocd.argoproj.io/compare-options
:
IgnoreExtraneous
argocd.argoproj.io/sync-options
:
Prune=false
These are required because the Postgres operator
does not apply owner references to child resources at the moment
.
References
¶
https://github.com/zalando/postgres-operator/issues/498
https://github.com/zalando/postgres-operator/issues/1766
2022-10-04