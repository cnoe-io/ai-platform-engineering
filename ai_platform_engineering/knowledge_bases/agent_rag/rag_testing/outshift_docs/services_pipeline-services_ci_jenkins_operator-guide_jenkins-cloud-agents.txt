jenkins cloud agents
Operator Guide: Jenkins Cloud Agents
¶
This document describes implementation details of the Jenkins Cloud Agents. For high-level motivation and usage guide, see the
User Guide: Jenkins Cloud Agents
.
Infrastructure-as-Code
¶
Terraform + Atlantis
¶
The creation/deletion of cloud agents is managed via Terraform configuration in
sre-tf-infra
. The agents are created in the
eti-ci
(ETI **C**ontinuous **I**ntegration) AWS account, managed via terraform
here
.
The Terraform code
here
also ensures that the host list that Ansible uses for provisioning these instances as Jenkins nodes (see the
Ansible
section) get updated on each apply.
Ansible
¶
Once the cloud agent EC2 instances are created by Terraform, an Ansible playbook must be run against them to configure those hosts with Jenkins dependencies and to register them with Jenkins. As mentioned in the
Terraform + Atlantis
section, Ansible uses the
atlantis_cloud_nodes
generated by Terraform to discover the EC2 instances it needs to configure as Jenkins worker nodes. The
cloud-nodes.yaml
meta-playbook captures all the playbook roles that must run on each host to be successfully registered as a worker node in our Jenkins. Specifying
cloud
as the first argument to the
run_ansible.sh
script ensures that this
cloud-nodes.yaml
meta-playbook gets invoked:
cd sre-build-infra-ansible
./scripts/run_ansible.sh cloud
Scaling Cloud Worker Nodes
¶
The number of cloud agents is configured by the
INSTANT_COUNT
variable in terraform, configured
here
. Update that number via the usual
Terraform + Atlantis workflow
to scale the number of worker nodes up or down.
2023-09-21