Client install
LDAP
Install and Configure LDAP Client on Ubuntu
¶
Note
Ansible role in progress to automate the process
sudo
apt-get
update
sudo
apt-get
-y
install
libnss-ldap
libpam-ldap
ldap-utils
nscd
Follow screen instruction and enter the values according to the environment.
Set LDAP URI:
ldaps://gspie-ns1.cisco.com/
or an IP address
10.200.96.87
Set a Distinguished name of the search base to
dc=gspie,dc=lab
Set the LDAP version to
3
.
Select
Yes
to make local root Database admin
Select
No
to LDAP database require login.
Set LDAP account for admin to
cn=admin,cd=gspie,cn=lab
Provide LDAP admin account Password
Finally, select md5 algorithm for the local crypt to use when changing passwords.
Configure authentication
¶
Edit
/etc/nsswitch.conf
and add LDAP authentication to passwd and group lines.
passwd:
compat
systemd
ldap
group:
compat
systemd
ldap
shadow:
compat
ldap
Modify the file
/etc/pam.d/common-password
and remove
use_authtok
on line 26 as shown below.
password
[
success
=
1
user_unknown
=
ignore
default
=
die
]
pam_ldap.so
try_first_pass
Enable creation of home directory on the first login by adding the following line to the end of file
/etc/pam.d/common-session
.
session
optional
pam_mkhomedir.so
skel
=
/etc/skel
umask
=
077
Enable SSL option by modifying
/etc/ldap.conf
and uncommenting the below lines.
ssl
start_tls
ssl
on
Restart the nscd service.
sudo
/etc/init.d/nscd
restart
Add
TLS_REQCERT allow
to
/etc/ldap.conf
echo
"TLS_REQCERT allow"
|
sudo
tee
/etc/ldap/ldap.conf
Finally, test by switching to a user account on LDAP
sreadmin@gspie-sn1:~#
su
-
jdoe
Creating
directory
'/home/jdeo'
.
jdoe@gspie-ns1:~$
id
uid
=
1055
(
jdoe
)
gid
=
555
(
jdoe
)
groups
=
555
(
jdoe
)
,27
(
sudo
)
,570
(
sre-admins
)
Re-authenticate the LDAP client
¶
Re-configure the LDAP client to re-sync the ldap server if any configuration is missed during installation or if the LDAP server config is changed.
sudo
dpkg-reconfigure
ldap-auth-config
Follow screen instruction  as shown above and enter the values according to the new environment.
2023-02-16