# Copyright 2025 CNOE
# SPDX-License-Identifier: Apache-2.0
# Generated by CNOE OpenAPI MCP Codegen tool

#!/usr/bin/env python3
"""
 MCP Server

This server provides a Model Context Protocol (MCP) interface to the ,
allowing large language models and AI assistants to interact with the service.
"""

import logging
import os
from dotenv import load_dotenv
from fastmcp import FastMCP


from mcp_backstage.tools import refresh

from mcp_backstage.tools import entities

from mcp_backstage.tools import entities_by_uid_uid

from mcp_backstage.tools import entities_by_name_kind_namespace_name

from mcp_backstage.tools import entities_by_name_kind_namespace_name_ancestry

from mcp_backstage.tools import entities_by_refs

from mcp_backstage.tools import entities_by_query

from mcp_backstage.tools import entity_facets

from mcp_backstage.tools import locations

from mcp_backstage.tools import locations_id

from mcp_backstage.tools import locations_by_entity_kind_namespace_name

from mcp_backstage.tools import analyze_location

from mcp_backstage.tools import validate_entity


def main():
  # Load environment variables
  load_dotenv()

  # Configure logging
  logging.basicConfig(level=logging.DEBUG)

  # Get MCP configuration from environment variables
  MCP_MODE = os.getenv("MCP_MODE", "STDIO")

  # Get host and port for server
  MCP_HOST = os.getenv("MCP_HOST", "localhost")
  MCP_PORT = int(os.getenv("MCP_PORT", "8000"))

  logging.info(f"Starting MCP server in {MCP_MODE} mode on {MCP_HOST}:{MCP_PORT}")

  # Get agent name from environment variables
  logging.info('*'*80)
  SERVER_NAME = os.getenv("SERVER_NAME", "BACKSTAGE")
  logging.info('*'*80)
  logging.info(f"MCP Server name: {SERVER_NAME}")

  # Create server instance
  if MCP_MODE.lower() in ["sse", "http"]:
    mcp = FastMCP(f"{SERVER_NAME} MCP Server", host=MCP_HOST, port=MCP_PORT)
  else:
    mcp = FastMCP(f"{SERVER_NAME} MCP Server")

  mcp.tool()(entities_by_query.get_entities_by_query)

  # Run the MCP server
  mcp.run(transport=MCP_MODE.lower())


if __name__ == "__main__":
  main()
