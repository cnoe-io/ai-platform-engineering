# ============================================================================
# AUTO-GENERATED FILE - DO NOT EDIT DIRECTLY
# ============================================================================
# Generated by: scripts/generate-docker-compose.py
# Mode: DEV (with local code mounts)
# Personas: komodor
# Transports: a2a-p2p, a2a-over-slim
#
# To regenerate this file, run:
#   make generate-compose PERSONAS="komodor" DEV=true
#
# Or manually:
#   ./scripts/generate-docker-compose.py --persona komodor --dev
#
# Usage:
#   docker compose -f docker-compose/docker-compose.komodor-dev.yaml --profile a2a-p2p up         # A2A peer-to-peer transport
#   docker compose -f docker-compose/docker-compose.komodor-dev.yaml --profile a2a-over-slim up   # A2A over SLIM transport
# ============================================================================

services:
  caipe-komodor-p2p:
    container_name: caipe-komodor-p2p
    volumes:
    - ../prompt_config.yaml:/app/prompt_config.yaml
    - ../persona.yaml:/app/persona.yaml
    - ../ai_platform_engineering:/app/ai_platform_engineering
    env_file:
    - ../.env
    ports:
    - 8000:8000
    environment:
    - A2A_TRANSPORT=p2p
    - KOMODOR_AGENT_HOST=agent-komodor-komodor-p2p
    - ENABLE_ARGOCD=false
    - ENABLE_AWS=false
    - ENABLE_BACKSTAGE=false
    - ENABLE_CONFLUENCE=false
    - ENABLE_GITHUB=false
    - ENABLE_JIRA=false
    - ENABLE_KOMODOR=true
    - ENABLE_PAGERDUTY=false
    - ENABLE_SLACK=false
    - ENABLE_SPLUNK=false
    - ENABLE_WEATHER_AGENT=false
    - ENABLE_WEBEX_AGENT=false
    - ENABLE_PETSTORE_AGENT=false
    - ENABLE_RAG=false
    depends_on:
    - agent-komodor-komodor-p2p
    command: platform-engineer
    build:
      context: ..
      dockerfile: build/Dockerfile
    profiles:
    - a2a-p2p
  agent-komodor-komodor-p2p:
    container_name: agent-komodor-komodor-p2p
    env_file:
    - ../.env
    ports:
    - 8001:8000
    environment:
    - A2A_TRANSPORT=p2p
    - MCP_MODE=http
    - MCP_HOST=mcp-komodor
    - MCP_PORT=8000
    depends_on:
    - mcp-komodor
    volumes:
    - ../ai_platform_engineering/agents/komodor/agent_komodor:/app/ai_platform_engineering/agents/komodor/agent_komodor
    - ../ai_platform_engineering/agents/komodor/clients:/app/ai_platform_engineering/agents/komodor/clients
    - ../ai_platform_engineering/common:/app/ai_platform_engineering/common
    build:
      context: ..
      dockerfile: ai_platform_engineering/agents/komodor/build/Dockerfile.a2a
    profiles:
    - a2a-p2p
  mcp-komodor:
    container_name: mcp-komodor
    env_file:
    - ../.env
    ports:
    - 18063:8000
    environment:
    - MCP_MODE=http
    - MCP_HOST=0.0.0.0
    - MCP_PORT=8000
    volumes:
    - ../ai_platform_engineering/agents/komodor/mcp/mcp_komodor:/app/mcp_komodor
    build:
      context: ../ai_platform_engineering/agents/komodor
      dockerfile: build/Dockerfile.mcp
    profiles:
    - a2a-p2p
    - a2a-over-slim
  caipe-komodor-slim:
    container_name: caipe-komodor-slim
    volumes:
    - ../prompt_config.yaml:/app/prompt_config.yaml
    - ../persona.yaml:/app/persona.yaml
    - ../ai_platform_engineering:/app/ai_platform_engineering
    env_file:
    - ../.env
    ports:
    - 8000:8000
    environment:
    - A2A_TRANSPORT=slim
    - KOMODOR_AGENT_HOST=agent-komodor-komodor-slim
    - ENABLE_ARGOCD=false
    - ENABLE_AWS=false
    - ENABLE_BACKSTAGE=false
    - ENABLE_CONFLUENCE=false
    - ENABLE_GITHUB=false
    - ENABLE_JIRA=false
    - ENABLE_KOMODOR=true
    - ENABLE_PAGERDUTY=false
    - ENABLE_SLACK=false
    - ENABLE_SPLUNK=false
    - ENABLE_WEATHER_AGENT=false
    - ENABLE_WEBEX_AGENT=false
    - ENABLE_PETSTORE_AGENT=false
    - ENABLE_RAG=false
    depends_on:
    - agent-komodor-komodor-slim
    - slim-dataplane
    - slim-control-plane
    command: platform-engineer
    build:
      context: ..
      dockerfile: build/Dockerfile
    profiles:
    - a2a-over-slim
  agent-komodor-komodor-slim:
    container_name: agent-komodor-komodor-slim
    env_file:
    - ../.env
    ports:
    - 8001:8000
    environment:
    - A2A_TRANSPORT=slim
    - MCP_MODE=http
    - MCP_HOST=mcp-komodor
    - MCP_PORT=8000
    depends_on:
    - mcp-komodor
    - slim-dataplane
    volumes:
    - ../ai_platform_engineering/agents/komodor/agent_komodor:/app/ai_platform_engineering/agents/komodor/agent_komodor
    - ../ai_platform_engineering/agents/komodor/clients:/app/ai_platform_engineering/agents/komodor/clients
    - ../ai_platform_engineering/common:/app/ai_platform_engineering/common
    build:
      context: ..
      dockerfile: ai_platform_engineering/agents/komodor/build/Dockerfile.a2a
    profiles:
    - a2a-over-slim
  slim-dataplane:
    image: ghcr.io/agntcy/slim:0.3.15
    container_name: slim-dataplane
    profiles:
    - a2a-over-slim
    ports:
    - 46357:46357
    environment:
    - PASSWORD=${SLIM_GATEWAY_PASSWORD:-dummy_password}
    - CONFIG_PATH=/config.yaml
    volumes:
    - ../slim-config.yaml:/config.yaml
    command:
    - /slim
    - --config
    - /config.yaml
  slim-control-plane:
    image: ghcr.io/agntcy/slim/control-plane:0.0.1
    container_name: slim-control-plane
    profiles:
    - a2a-over-slim
    ports:
    - 50051:50051
    - 50052:50052
    environment:
    - PASSWORD=${SLIM_GATEWAY_PASSWORD:-dummy_password}
    - CONFIG_PATH=/config.yaml
    volumes:
    - ../slim-config.yaml:/config.yaml
    command:
    - /slim
    - --config
    - /config.yaml
